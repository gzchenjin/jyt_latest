document.addEventListener('DOMContentLoaded', function() {
    // ======================= DATA (from .py files) =======================
    const PM_DATA = [
        {"项目经理": "丁明", "级别": "资深级", "在职部门": "IT系统事业部"},
{"项目经理": "布和", "级别": "高级", "在职部门": "IT系统事业部"},
{"项目经理": "陈炼斌", "级别": "高级", "在职部门": "IT系统事业部"},
{"项目经理": "董林强", "级别": "高级", "在职部门": "IT系统事业部"},
{"项目经理": "刘树聪", "级别": "高级", "在职部门": "IT系统事业部"},
{"项目经理": "莫海斌", "级别": "高级", "在职部门": "IT系统事业部"},
{"项目经理": "彭杜葳", "级别": "高级", "在职部门": "IT系统事业部"},
{"项目经理": "王敏", "级别": "高级", "在职部门": "IT系统事业部"},
{"项目经理": "相莹", "级别": "高级", "在职部门": "IT系统事业部"},
{"项目经理": "徐一品", "级别": "高级", "在职部门": "IT系统事业部"},
{"项目经理": "张宏", "级别": "高级", "在职部门": "IT系统事业部"},
{"项目经理": "张声玉", "级别": "高级", "在职部门": "IT系统事业部"},
{"项目经理": "陈靖妍", "级别": "中级", "在职部门": "IT系统事业部"},
{"项目经理": "陈文", "级别": "中级", "在职部门": "IT系统事业部"},
{"项目经理": "陈泽华", "级别": "中级", "在职部门": "IT系统事业部"},
{"项目经理": "冯思明", "级别": "中级", "在职部门": "IT系统事业部"},
{"项目经理": "何晓云", "级别": "中级", "在职部门": "IT系统事业部"},
{"项目经理": "胡世敏", "级别": "中级", "在职部门": "IT系统事业部"},
{"项目经理": "李华辉", "级别": "中级", "在职部门": "IT系统事业部"},
{"项目经理": "李巍", "级别": "中级", "在职部门": "IT系统事业部"},
{"项目经理": "廖如意", "级别": "中级", "在职部门": "IT系统事业部"},
{"项目经理": "刘礼铭", "级别": "中级", "在职部门": "IT系统事业部"},
{"项目经理": "邱顺记", "级别": "中级", "在职部门": "IT系统事业部"},
{"项目经理": "饶安辉", "级别": "中级", "在职部门": "IT系统事业部"},
{"项目经理": "谭丽颖", "级别": "中级", "在职部门": "IT系统事业部"},
{"项目经理": "谭敏", "级别": "中级", "在职部门": "IT系统事业部"},
{"项目经理": "王灿", "级别": "中级", "在职部门": "IT系统事业部"},
{"项目经理": "王健涛", "级别": "中级", "在职部门": "IT系统事业部"},
{"项目经理": "吴利仙", "级别": "中级", "在职部门": "IT系统事业部"},
{"项目经理": "颜坚敏", "级别": "中级", "在职部门": "IT系统事业部"},
{"项目经理": "杨华茂", "级别": "中级", "在职部门": "IT系统事业部"},
{"项目经理": "章瑞莉", "级别": "中级", "在职部门": "IT系统事业部"},
{"项目经理": "蔡丽萍", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "蔡实楷", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "曾蓉", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "曾小生", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "陈健强", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "邓志强", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "傅强", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "关朝义", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "郭玉英", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "韩智明", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "洪娟1", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "胡国晴", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "黄伟2", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "黄志坚", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "康信锐", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "邝镇升", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "赖豪强", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "蓝超", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "黎子裕", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "李小云", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "李永锋", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "梁广泉", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "刘存", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "麦子浩", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "倪绮媚", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "欧彦宏", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "曲明", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "饶志华", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "沈慧彪", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "沈吉林", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "孙杰", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "谭伟祺", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "卫宇星", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "肖亮芬", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "谢明理", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "谢鹏烨", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "阳德武", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "杨明华", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "杨莹", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "杨志伟", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "余长春", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "张辉", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "张蕾", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "张淑媛", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "赵文锴", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "郑拔", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "郑锦萍", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "朱银利", "级别": "初级", "在职部门": "IT系统事业部"},
{"项目经理": "唐诏", "级别": "专家级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "张郭强", "级别": "专家级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "赖守义", "级别": "高级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "刘元琪", "级别": "高级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "芦康磊", "级别": "高级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "谢国城", "级别": "高级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "余超杰", "级别": "高级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "余文博", "级别": "高级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "张雷", "级别": "高级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "陈皇均", "级别": "中级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "黄永华", "级别": "中级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "李晓倩", "级别": "中级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "李增城", "级别": "中级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "刘志明", "级别": "中级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "彭文君", "级别": "中级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "蔡晓文", "级别": "初级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "曾培植", "级别": "初级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "曾舒新", "级别": "初级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "陈振希", "级别": "初级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "陈追平", "级别": "初级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "邓驹", "级别": "初级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "梁吉富", "级别": "初级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "刘志斌", "级别": "初级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "任恒波", "级别": "初级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "王安明", "级别": "初级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "向家俊", "级别": "初级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "叶隆明", "级别": "初级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "张君", "级别": "初级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "张伟2", "级别": "初级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "张运基", "级别": "初级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "赵明涛", "级别": "初级", "在职部门": "大数据AI应用事业部"},
{"项目经理": "庄晓东", "级别": "初级", "在职部门": "科创部"},
{"项目经理": "涂冠平", "级别": "资深级", "在职部门": "数字政府事业部"},
{"项目经理": "黄建松", "级别": "专家级", "在职部门": "数字政府事业部"},
{"项目经理": "陈嘉翔", "级别": "专家级", "在职部门": "数字政府事业部"},
{"项目经理": "陈建华", "级别": "高级", "在职部门": "数字政府事业部"},
{"项目经理": "范新星", "级别": "高级", "在职部门": "数字政府事业部"},
{"项目经理": "胡蓉", "级别": "高级", "在职部门": "数字政府事业部"},
{"项目经理": "匡萃玮", "级别": "高级", "在职部门": "数字政府事业部"},
{"项目经理": "李东明", "级别": "高级", "在职部门": "数字政府事业部"},
{"项目经理": "李杰超", "级别": "高级", "在职部门": "数字政府事业部"},
{"项目经理": "刘林泉", "级别": "高级", "在职部门": "数字政府事业部"},
{"项目经理": "肖志伟", "级别": "高级", "在职部门": "数字政府事业部"},
{"项目经理": "谢镜平", "级别": "高级", "在职部门": "数字政府事业部"},
{"项目经理": "朱辰生", "级别": "高级", "在职部门": "数字政府事业部"},
{"项目经理": "曾威", "级别": "高级", "在职部门": "数字政府事业部"},
{"项目经理": "范金盛", "级别": "高级", "在职部门": "数字政府事业部"},
{"项目经理": "王天堂", "级别": "高级", "在职部门": "数字政府事业部"},
{"项目经理": "陈创涛1", "级别": "中级", "在职部门": "数字政府事业部"},
{"项目经理": "陈志", "级别": "中级", "在职部门": "数字政府事业部"},
{"项目经理": "戴卓骅", "级别": "中级", "在职部门": "数字政府事业部"},
{"项目经理": "华德锋", "级别": "中级", "在职部门": "数字政府事业部"},
{"项目经理": "贾辉", "级别": "中级", "在职部门": "数字政府事业部"},
{"项目经理": "李富维", "级别": "中级", "在职部门": "数字政府事业部"},
{"项目经理": "李申明1", "级别": "中级", "在职部门": "数字政府事业部"},
{"项目经理": "吕文昱", "级别": "中级", "在职部门": "数字政府事业部"},
{"项目经理": "沈强1", "级别": "中级", "在职部门": "数字政府事业部"},
{"项目经理": "涂彩霞", "级别": "中级", "在职部门": "数字政府事业部"},
{"项目经理": "谢敬", "级别": "中级", "在职部门": "数字政府事业部"},
{"项目经理": "卓小夏", "级别": "中级", "在职部门": "数字政府事业部"},
{"项目经理": "邱根卫", "级别": "中级", "在职部门": "数字政府事业部"},
{"项目经理": "张子淇", "级别": "中级", "在职部门": "数字政府事业部"},
{"项目经理": "陈上达", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "陈振熙", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "程明杰", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "何刚", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "洪泽智", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "洪智钏", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "黄麒铭", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "蒋智文", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "李兴乐", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "刘昌昕", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "屈川", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "容韦超", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "宋华传", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "吴丹青", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "吴洁丽", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "吴永雄", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "吴育涛", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "陈相源", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "曾爱芬", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "陈志龙", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "代文超1", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "范志鸿", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "侯维池", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "黄舒璟", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "梁婵", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "梁志豪", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "林仁行", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "王玮彦", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "吴文正", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "赵秋华1", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "钟石强", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "仲平杰", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "邹松岭", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "伍永锋", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "张栋", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "侯筠", "级别": "初级", "在职部门": "数字政府事业部"},
{"项目经理": "邓国辉", "级别": "专家级", "在职部门": "云网事业部"},
{"项目经理": "高斯", "级别": "专家级", "在职部门": "云网事业部"},
{"项目经理": "杨宁1", "级别": "专家级", "在职部门": "云网事业部"},
{"项目经理": "廖志高", "级别": "高级", "在职部门": "云网事业部"},
{"项目经理": "彭明辉", "级别": "高级", "在职部门": "云网事业部"},
{"项目经理": "彭舒婷", "级别": "高级", "在职部门": "云网事业部"},
{"项目经理": "苏智2", "级别": "高级", "在职部门": "云网事业部"},
{"项目经理": "谢兴之", "级别": "高级", "在职部门": "云网事业部"},
{"项目经理": "叶伟军", "级别": "高级", "在职部门": "云网事业部"},
{"项目经理": "余文海", "级别": "高级", "在职部门": "云网事业部"},
{"项目经理": "张方月1", "级别": "高级", "在职部门": "云网事业部"},
{"项目经理": "钟少山1", "级别": "高级", "在职部门": "云网事业部"},
{"项目经理": "邹国栋", "级别": "高级", "在职部门": "云网事业部"},
{"项目经理": "高仲君", "级别": "中级", "在职部门": "云网事业部"},
{"项目经理": "李纯宜", "级别": "中级", "在职部门": "云网事业部"},
{"项目经理": "李德", "级别": "中级", "在职部门": "云网事业部"},
{"项目经理": "李裕鑫", "级别": "中级", "在职部门": "云网事业部"},
{"项目经理": "连振明", "级别": "中级", "在职部门": "云网事业部"},
{"项目经理": "卢建中", "级别": "中级", "在职部门": "云网事业部"},
{"项目经理": "谭力轩", "级别": "中级", "在职部门": "云网事业部"},
{"项目经理": "谢理卫", "级别": "中级", "在职部门": "云网事业部"},
{"项目经理": "许静荷", "级别": "中级", "在职部门": "云网事业部"},
{"项目经理": "余茂林", "级别": "中级", "在职部门": "云网事业部"},
{"项目经理": "喻凯", "级别": "中级", "在职部门": "云网事业部"},
{"项目经理": "衷小鹏", "级别": "中级", "在职部门": "云网事业部"},
{"项目经理": "王鹏飞", "级别": "中级", "在职部门": "云网事业部"},
{"项目经理": "黄奕佳", "级别": "中级", "在职部门": "云网事业部"},
{"项目经理": "叶祥健", "级别": "中级", "在职部门": "云网事业部"},
{"项目经理": "陈新民", "级别": "初级", "在职部门": "云网事业部"},
{"项目经理": "何悦", "级别": "初级", "在职部门": "云网事业部"},
{"项目经理": "梁乾标", "级别": "初级", "在职部门": "云网事业部"},
{"项目经理": "丘嘉燕", "级别": "初级", "在职部门": "云网事业部"},
{"项目经理": "申加克", "级别": "初级", "在职部门": "云网事业部"},
{"项目经理": "汪国海", "级别": "初级", "在职部门": "云网事业部"},
{"项目经理": "周海兵", "级别": "初级", "在职部门": "云网事业部"},
{"项目经理": "罗国雄", "级别": "高级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "罗伟杰", "级别": "高级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "孙华", "级别": "高级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "王沛文", "级别": "高级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "吴中华", "级别": "高级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "陈家辉", "级别": "初级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "陈勇", "级别": "初级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "程鸣", "级别": "初级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "邓政彬", "级别": "初级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "高航", "级别": "初级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "黄俊威", "级别": "初级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "雷卫国", "级别": "初级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "鹿曼1", "级别": "初级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "彭放", "级别": "初级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "吴丹1", "级别": "初级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "颜敏", "级别": "初级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "杨殷", "级别": "初级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "钟北", "级别": "初级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "周黎", "级别": "初级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "朱鹏飞", "级别": "初级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "朱霄", "级别": "初级", "在职部门": "运营管理部/研发与质量管理中心"},
{"项目经理": "王亮", "级别": "初级", "在职部门": "战略客户事业群"},
{"项目经理": "陈刚", "级别": "资深级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "陈堉颖", "级别": "资深级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "梁方明", "级别": "专家级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "吴庆香", "级别": "专家级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "邓求智", "级别": "高级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "蓝超飞", "级别": "高级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "李娟1", "级别": "高级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "梁梓华", "级别": "高级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "林喜", "级别": "高级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "彭锦宏", "级别": "高级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "吴梦楚", "级别": "高级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "闫成杰", "级别": "高级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "袁斌杰", "级别": "高级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "袁俊", "级别": "高级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "张轩豪", "级别": "高级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "卓上斐", "级别": "高级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "黄俊荣", "级别": "高级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "巫智威", "级别": "高级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "李玉鹏", "级别": "高级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "林宏正", "级别": "高级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "蓝超儒", "级别": "高级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "陈任全", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "顾荣华", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "管森", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "何名灏", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "洪学敏", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "黄纯", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "黄华秋", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "黄炜", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "李明江", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "李治秀", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "林江华", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "刘政浩", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "骆超", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "孙晓强", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "王爽", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "谢慧章", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "邓盛文", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "黄松华", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "廖淑娟", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "禤聪", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "赵嘉怡", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "潘房伟", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "全斯靖", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "傅平", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "颜仕凯", "级别": "中级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "高思远", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "何嘉敏1", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "黄沛1", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "刘修伟", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "沈江源", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "王坚任", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "吴梦荣", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "许敏", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "杨朦", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "张曼希", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "陈晓", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "王晋民", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "曾东艺", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "陈昱材", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "蒋海峰", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "廖晨希", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "彭希", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "王远庚", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "张德文", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "陈胜琳", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "肖文影", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "陈垂华", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "李挺康", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "林雪", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "吴紫安", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "杨司政", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "詹成衡", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "张玲玲", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "贾延昌", "级别": "初级", "在职部门": "智慧企业集成事业部"},
{"项目经理": "董佐君", "级别": "高级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "黄晓云1", "级别": "高级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "林海霞", "级别": "高级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "刘锦添", "级别": "高级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "张熙", "级别": "高级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "赵亮", "级别": "高级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "周丹莹", "级别": "高级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "甘茂鹏", "级别": "高级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "关志毅", "级别": "高级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "梁智强", "级别": "高级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "袁超强", "级别": "高级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "刘妮", "级别": "高级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "余松明", "级别": "高级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "曾玄昴", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "陈沛琼", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "甘地", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "何韶炜", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "胡芸", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "库志春1", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "廖养源", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "廖子常", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "苏小东", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "孙作海", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "王海涛", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "王星火", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "熊辉", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "徐梦秋1", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "杨庆辉", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "赵立超", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "陈新裕", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "巩亮", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "郭豫丹", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "何小强", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "黄江海", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "黄苑芳", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "李金山1", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "林祥通", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "区晓军", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "王向辉", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "伍绍秋", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "夏媛", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "张飞鹰", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "周杜锦", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "鞠昊星", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "蔡伟武", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "冯全通", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "宋亚男", "级别": "中级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "蔡冠祥", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "高凌风", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "何川", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "黄海", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "黄煦", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "梁瑞豪", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "刘栩生", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "彭理伦", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "邵东", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "唐志成", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "王嵩伟", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "杨子浩", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "张玮", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "郑嘉凤", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "曾佳丽", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "韩素茵", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "李直", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "千华", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "王家豪", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "颜耀兰", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "姚文山2", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "喻海超1", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "张兴周", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "张元强", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "张宗平2", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "周利", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "黄绍辉", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "陶瑞阳", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "陈美玲", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "吕志聪", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "宋波", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "王月华", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "吴小燕", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "叶锵1", "级别": "初级", "在职部门": "智慧网络运营事业部"},
{"项目经理": "何洪乾", "级别": "高级", "在职部门": "智慧业财事业部"},
{"项目经理": "胡敏2", "级别": "高级", "在职部门": "智慧业财事业部"},
{"项目经理": "吕志正", "级别": "高级", "在职部门": "智慧业财事业部"},
{"项目经理": "汪春满", "级别": "高级", "在职部门": "智慧业财事业部"},
{"项目经理": "夏斌斌", "级别": "高级", "在职部门": "智慧业财事业部"},
{"项目经理": "谢晓建1", "级别": "高级", "在职部门": "智慧业财事业部"},
{"项目经理": "许桐署", "级别": "高级", "在职部门": "智慧业财事业部"},
{"项目经理": "张峰", "级别": "高级", "在职部门": "智慧业财事业部"},
{"项目经理": "张婷", "级别": "高级", "在职部门": "智慧业财事业部"},
{"项目经理": "张威煌", "级别": "高级", "在职部门": "智慧业财事业部"},
{"项目经理": "曾小龙", "级别": "中级", "在职部门": "智慧业财事业部"},
{"项目经理": "黄涛涛", "级别": "中级", "在职部门": "智慧业财事业部"},
{"项目经理": "伍智迅", "级别": "中级", "在职部门": "智慧业财事业部"},
{"项目经理": "谢霖", "级别": "中级", "在职部门": "智慧业财事业部"},
{"项目经理": "谢荣凤", "级别": "中级", "在职部门": "智慧业财事业部"},
{"项目经理": "钟全虎", "级别": "中级", "在职部门": "智慧业财事业部"},
{"项目经理": "曹震安", "级别": "初级", "在职部门": "智慧业财事业部"},
{"项目经理": "曾科", "级别": "初级", "在职部门": "智慧业财事业部"},
{"项目经理": "陈倍庆", "级别": "初级", "在职部门": "智慧业财事业部"},
{"项目经理": "方灿加", "级别": "初级", "在职部门": "智慧业财事业部"},
{"项目经理": "何发", "级别": "初级", "在职部门": "智慧业财事业部"},
{"项目经理": "黄发龙", "级别": "初级", "在职部门": "智慧业财事业部"},
{"项目经理": "姜莎", "级别": "初级", "在职部门": "智慧业财事业部"},
{"项目经理": "李晖", "级别": "初级", "在职部门": "智慧业财事业部"},
{"项目经理": "唐大伟", "级别": "初级", "在职部门": "智慧业财事业部"},
    ];

    const EMAIL_DATA = {
         

};


    const HELP_HTML = `
    <h2 id="toc" style="color:#444;">
  <span style="font-family:'Segoe UI Emoji';">&#8203;📑</span>
  <span style="font-family:'Microsoft YaHei';"> 目录</span>
</h2>
<div>
<ul>
<li><span style="color: #ff0000;"><a style="color: #ff0000;" href="#index_basic_info">项目基本信息</a></span>&nbsp;</li>
<li><span style="color: #0000ff;"><a style="color: #0000ff;" href="#index_procurementRisk">外采风险</a>&mdash;<a style="color: #0000ff;" href="#index_ironTriangleInput">铁三角信息</a>&mdash;<a style="color: #0000ff;" href="#index_deliveryDetails">产能部门子表</a></span></li>
</ul>
</div>
<div>
<ul>
<li><span style="color: #ff0000;"><a style="color: #ff0000;" href="#index_sj">商机评估会</a></span></li>
<li><span style="color: #0000ff;"><a style="color: #0000ff;" href="#Index_SJ_projectRisk">存在风险（商机）</a>&mdash;<a style="color: #0000ff;" href="#Index_SJ_projectCooperationAssessment">合作评估</a>&mdash;<a style="color: #0000ff;" href="#Index_SJ_preInvestmentDetails">预投入</a>&mdash;<a style="color: #0000ff;" href="#Index_SJ_atomicCapability">原子能力</a></span></li>
</ul>
</div>
<div>
<ul>
<li><span style="color: #ff0000;"><a style="color: #ff0000;" href="#index_tb">投标评估会</a></span></li>
<li><span style="color: #0000ff;"><a style="color: #0000ff;" href="#Index_TB_businessType">业务类型</a>&mdash;<a style="color: #0000ff;" href="#Index_TB_biddingRisk">招投标风险</a>&mdash;<a style="color: #0000ff;" href="#Index_TB_deliveryPeriod">交付周期</a>&mdash;<a style="color: #0000ff;" href="#Index_TB_deliveryRisk">交付风险</a>&mdash;<a style="color: #0000ff;" href="#Index_TB_projectCooperationAssessment">合作评估</a>&mdash;<a style="color: #0000ff;" href="#Index_TB_maintenanceRequirements">运维要求</a>&mdash;<a style="color: #0000ff;" href="#Index_TB_trialRun">试运行</a>&mdash;<a style="color: #0000ff;" href="#Index_TB_securityAssessment">主责系统</a>&mdash;<a style="color: #0000ff;" href="#Index_TB_maintenanceAssessment">运维服务评估</a>&mdash;<a style="color: #0000ff;" href="#Index_TB_testingRequirements">等保测评/第三方测评</a>&mdash;<a style="color: #0000ff;" href="#Index_Index_TB_financialAssessment">财务评估</a></span></li>
</ul>
</div>
<div>
<ul>
<li><span style="color: #ff0000;"><a style="color: #ff0000;" href="#index_jd">项目交底会</a></span></li>
<li><span style="color: #0000ff;"><a style="color: #0000ff;" href="#Index_JD_businessType">业务类型</a>&mdash;<a style="color: #0000ff;" href="#Index_JD_deliveryPeriod">交付周期</a>&mdash;<a style="color: #0000ff;" href="#Index_JD_deliveryRisk">交付风险</a>&mdash;<a style="color: #0000ff;" href="#Index_JD_maintenanceRequirements">运维要求</a>&mdash;<a style="color: #0000ff;" href="#Index_JD_trialRun">试运行</a>&mdash;<a style="color: #0000ff;" href="#Index_JD_maintenanceAssessment">运维服务评估</a>&mdash;<a style="color: #0000ff;" href="#Index_JD_testingRequirements">等保测评/第三方测评</a>&mdash;<a style="color: #0000ff;" href="#Index_JD_publicPlatform">公共架构</a></span></li>
</ul>
</div>
<div>
<ul>
<li><span style="color: #ff0000;"><a style="color: #ff0000;" href="#index_others">其他情况</a></span></li>
</ul>
</div>
<div>
<ul>
<li><span style="color: #ff0000;"><a style="color: #ff0000;" href="#index_other_info">其他核对要点</a></span></li>
</ul>
</div>
<hr />
<h3 id="index_basic_info" style="color: #d9534f;">项目基本信息</h3>
<div><strong>项目名称：</strong>XXXX项目</div>
<div>&nbsp;</div>
<div><strong>商机编码：</strong>SJYXGD202500000</div>
<div>&nbsp;</div>
<div><strong>预算金额：</strong>单位元，含税，无需填写单位</div>
<div>&nbsp;</div>
<div><strong>最终客户：</strong>项目实际需求客户：</div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">&bull; 存在两种可能，按实际情况填写</div>
<div style="margin-left: 40px;">签约客户的前向客户</div>
<div style="margin-left: 40px;">签约客户</div>
<div>&nbsp;</div>
<div><strong>外采金额：</strong>单位元，含税，无需填写单位</div>
<div>&nbsp;</div>
<div><strong>产能能力：</strong>详见集成项目定义区分多产能项目与集成项目区别</div>
<div><br />
<div style="margin-left: 40px;">&bull; <strong>多产能项目：</strong>电信体系项目涉及两个（含）以上产能</div>
<div style="margin-left: 40px;">&bull; <strong>大集成项目：</strong>行业项目涉及两个（含）以上产能</div>
<br />
<div style="margin-left: 40px;">&bull; <strong>项目级别：</strong>划分标准（合同金额指商机的含税的&ldquo;项目预算&rdquo;）</div>
<div style="margin-left: 40px;"><br />战略类的为A类项目（由公司决策明确）</div>
<div style="margin-left: 40px;"><br />集成/多产能项目：<br />A类：合同金额&ge;1000万的<br />B类：500万&le;合同金额＜1000万<br />C类：合同金额＜500万的为C类项目</div>
<div style="margin-left: 40px;"><br />单产能（非集成类）项目：<br />A类：合同金额&ge;500万<br />B类：200万&le;合同金额＜500万的<br />C类：合同金额＜200万</div>
<div>&nbsp;</div>
<div><strong>建设内容：</strong>详见集成项目定义区分多产能项目与集成项目区别</div>
<div>
<div style="margin-left: 40px;">&nbsp;</div>
<div style="margin-left: 40px;">建设内容=牵头事业部负责交付内容+所有协助交付事业部交付内容+外采内容</div>
&nbsp;</div>
<div>&nbsp;</div>
<div id="index_procurementRisk">
<div><strong>外采风险：</strong></div>
</div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">&bull;&nbsp;<strong>示例：</strong><br /><span style="color: #0000ff;">本项目XXX事业部负责项目XXX工作/内容。XXX（外采的内容，必须有出处，需核对客户需求清单，不能无中生有）工作/内容，因XXX原因（外采原因，客观有理有据），需后向采购，外采总预算XXX万（含税）</span></div>
<div style="margin-left: 40px;">&nbsp;</div>
<div style="margin-left: 40px;">&bull;&nbsp;<strong>注意事项</strong></div>
<div style="margin-left: 40px;">1、严禁外采自有能力<br />2、严禁过手，无自有能力外采，即客户需求直接照搬，全部或大比例，主体部分外采<br />3、杜绝无中生有的虚假项目<br />4、严查高风险项目外采，特别是需要垫资的情况<br />5、<span style="color: #ff0000;">所有项目均需要事业部出具外采说明扫描件，A类项目以邮件方式提供。涉及自有能力外采，视乎情况需要上升分管领导决策</span><br />6、管理层要求：项目已经列收的又提出新外包需求，需要重开两点三会的，一律卡死，如果剩余未列收部分的无法覆盖新增外采金额的，全部走上会汇报<br />7、<span style="color: #ff0000;">如果涉及硬件项目，需要写上：项目涉及硬件采购，需要关注中小企业供应商，以降低项目执行中垫资风险</span><br />8、<strong><span style="color: #ff0000;">前后向高度一致，无实质交付内容，重点考虑是否可全额列收</span></strong></div>
<div style="margin-left: 40px;">&nbsp;</div>
</div>
<div>
<div style="margin-left: 40px;"><strong><span style="color: #ff0000;">&bull;外采说明（例）：</span></strong></div>
<div style="margin-left: 40px;">&nbsp;</div>
<div style="margin-left: 40px;"><span style="color: #0000ff;">项目名：XXX</span><br /><span style="color: #0000ff;">商机编号：XXX</span><br /><span style="color: #0000ff;">项目建设内容：XX项目</span><br /><span style="color: #0000ff;">XX事业部负责，XXX建设内容</span><br /><span style="color: #0000ff;">外采原因：因xxx原因，需要外采，外采内容：</span><br /><span style="color: #0000ff;">1）XXX，收入预算XX万，采购预算XX万；</span><br /><span style="color: #0000ff;">2）XXX，收入预算XX万，采购预算XX万；</span></div>
<div style="margin-left: 40px;"><br /><span style="color: #0000ff;">项目经理签字：xxx</span><br /><span style="color: #0000ff;">部门经理签字：xxx</span><br /><span style="color: #0000ff;">202x/xx/xx</span></div>
<div style="margin-left: 40px;">&nbsp;</div>
<div style="margin-left: 40px;"><span style="color: #0000ff;"><span style="color: #ff0000;">&bull;【A类项目】外采产能部门项目经理、部门经理签字，外采说明需扫描，邮件主送砺剑PMO，陈晋，抄送分管领导、部门领导、市场部邓总、汪总</span><br /></span></div>
</div>
<div>
<div>&nbsp;</div>
<div id="index_ironTriangleInput">
<div><strong>铁三角信息：</strong></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">&bull;&nbsp;<strong>示例：</strong><span style="color: #ff0000;">直接复制项管系统铁三角信息，格式如下</span><br /><span style="color: #0000ff;">项目经理：</span><br /><span style="color: #0000ff;">XXX(事业部名)</span><br /><span style="color: #0000ff;">销售经理：</span><br /><span style="color: #0000ff;">XXX(销售部门名)</span><br /><span style="color: #0000ff;">方案经理：</span><br /><span style="color: #0000ff;">XXX(事业部名)</span><br /><span style="color: #0000ff;">交付经理：</span><br /><span style="color: #0000ff;">XXX(事业部名)</span></div>
</div>
</div>
<div id="index_deliveryDetails">
<div>&nbsp;&nbsp;
<div><strong>产能部门子表：</strong><span style="color: #ff0000;">单产能项目无需填写，多产能/大集成项目需要填写</span></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">1、明确项目各部门项目经理/子项目经理情况、预算情况、交付情况<br />2、单产能项目须填写事业部和项目经理，其他留空，多产能须全部填写齐全<br />3、A类项目必须要高级项目经理<br />4、BC类项目无要求<br />5、A类项目最低要求：团队总监担任，此情况下必须在会议纪要中其他情况说明。若项目经理也非团队总监，更应重点说明。</div>
</div>
<div>&nbsp;</div>
<hr />
<h3 id="index_sj" style="color: #d9534f;">商机评估会</h3>
<div><strong>毛利率：</strong>不含税，保留两位小数</div>
<div>&nbsp;</div>
<div><strong>净利润率：</strong>不含税，保留两位小数</div>
<div>&nbsp;</div>
<div>
<div id="Index_SJ_projectRisk">
<div><strong>存在风险（商机）：</strong></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">&bull;&nbsp;<strong>模板：</strong><span style="color: #ff0000;">商机阶段风险初步评估（签约风险、需求风险、提前开工风险等），项目组如实反馈风险。</span><br />1）签约侧：XXX<br />2）交付侧：XXX</div>
<div style="margin-left: 40px;">&nbsp;</div>
<div style="margin-left: 40px;">&bull;&nbsp;<strong>示例：</strong></div>
<div style="margin-left: 40px;"><span style="color: #0000ff;">1）签约侧：客户侧目前已完成立项，预估2月份发标，暂无签约侧风险；</span><br /><span style="color: #0000ff;">2）交付侧：经项目经理反馈，前期已与客户完成需求调研，经项目组反馈本项目不存在签约及交付风险</span><br /><span style="color: #0000ff;">1）签约侧：本项目为延续性项目，客情关系好，项目组评估中标概率较高；</span><br /><span style="color: #0000ff;">2）交付侧：由于本项目属于延续性项目，现有平台系统的开发支撑均由亿迅承接，因此预判交付侧暂无问题</span>&nbsp;</div>
</div>
</div>
<div>&nbsp;</div>
<div id="Index_SJ_projectCooperationAssessment">
<div><strong>合作评估：</strong></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;"><span style="color: #ff0000;">&bull; 邀请市场部项目合作评估师参会，对合作伙伴是否有风险进行评估把关、给出评估结论</span><br /><span style="color: #ff0000;">A角：高仲凯 B角：许海燕</span><br />&nbsp;</div>
<div style="margin-left: 40px;">&bull;&nbsp;<strong>示例：</strong>评估要点与采购风险要求一致，严禁自有能力合作等<br /><span style="color: #0000ff;">经项目组确认，本项目XXX事业部负责项目XXX工作/内容。XXX（需合作的内容，必须有出处，需核对客户需求清单，不能无中生有）工作/内容，因XXX原因（合作原因，客观有理有据，不能以客情作为合作依据），需要进行标前引入，经评估：本项目最终用户是 ICT 客户XXX，签约客户XXX，拟引入合作伙伴为XXXXX，我司与合作伙伴合作规模为XXX万元，合作内容为XXX，开标时间为XXXX年XX月XX日，能满足客户本项目的需求。经渠道部门、产能部门、市场部评估，建议选择方式是xxxxx（公开遴选，邀请遴选，公开方式，定向方式）。本项目非电信投资项目、前后向公司之间的股东不存在关联性关系，招标文件或前向合同无硬性要求相关资质；开标时间较紧，请项目组尽快提交合作引入材料</span></div>
</div>
<div>&nbsp;
<div id="Index_SJ_preInvestmentDetails">
<div><strong>预投入情况：</strong></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;"><span style="color: #000000;">&bull; 记录提前开工情况（提前开工原因、提前开工的时间点、预估成本、当前实施进度、已投入情况、预估签约时间）</span><br />&bull;&nbsp;<strong>示例：</strong><br /><span style="color: #0000ff;">（若属于预投项目）本项目由于xxx原因，需要提前介入实施，已从25年XX月开始预投入/预计需从25年XX月开始预投入，项目总成本预估xxx万，整体交付周期为XX个月；截至目前交付进度约为xx%，已投入约xx万，预计签约时间为25年xx月xx日（原则上预计签约时间不能跨年），请项目组尽快完成预投入审批流程【A类项目提醒，BC类无需】</span></div>
</div>
<div>&nbsp;&nbsp;</div>
</div>
<div id="Index_SJ_atomicCapability">
<div><strong>原子能力情况：</strong>（是否调用及原因说明、调用的编号）</div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">&bull;&nbsp;<strong>示例：</strong><br /><span style="color: #0000ff;">1、本项目由于行业客户直签项目，不涉及原子能力使用</span><br /><span style="color: #0000ff;">2、本项目客户要求使用合同签约方式，暂不涉及原子能力使用</span><br /><span style="color: #0000ff;">3、本项目为投资项目，不涉及原子能力调用</span><br /><span style="color: #0000ff;">4、本项目签约客户为XXX，客户采用框架内下订单的方式，不涉及原子能力调用</span></div>
</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<hr />
<h3 id="index_tb" style="color: #d9534f;">投标评估会</h3>
<div>
<div>
<div id="Index_TB_businessType">
<div><strong>业务类型：</strong></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">服务运营类：按周期提供服务<br />软件研发类：按客户要求进行软件研发。交付自有能力产品<br />大集成项目：见定义</div>
</div>
</div>
<div><br />
<div><strong>大集成类项目的定义：</strong></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">1、集成部按产能净收的6%收取项目管理费，扣减产能净收、计入集成部净收<br />2、面向电信公司、电信内部门、体系内专业公司的项目，原则上不定义为集成类项目，如由集成部牵头，需由商机评估会确认<br />3、面向行业客户的项目，2个或以上产能部门参与的，原则上定义为集成类项目，由集成部牵头<br />4、面向行业客户的项目，涉及单产能的，外包比例&gt;50%的，原则上定义为集成类项目，由集成部牵头。</div>
</div>
<div>&nbsp;</div>
<div><strong>毛利率：</strong>不含税，保留两位小数</div>
<div>
<div>&nbsp;</div>
<div><strong>投标方式：</strong></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">公开/邀请招标/比选：必填写开标时间、中标公示时间<br />单一来源、询价、谈判：必填应答时间</div>
</div>
<div>
<div>
<div>&nbsp;&nbsp;</div>
</div>
<div id="Index_TB_biddingRisk">
<div><strong>招投标风险：</strong><span style="color: #ff0000;">（得失分、中标概率）</span></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">&bull;&nbsp;<strong>示例：</strong><br /><span style="color: #0000ff;">本项目签约客户采用公开招标方式进行，投标得分预估：商务部分满分30分，预估得分30分；技术服务部分满分60分，预估得分57分；价格满分10分，因涉及主观评分暂无法预估。总体投标得分较高，项目组评估中标概率一般</span></div>
</div>
</div>
<div>
<div>
<div>&nbsp;&nbsp;</div>
</div>
<div id="Index_TB_deliveryPeriod">
<div><strong>交付周期：</strong><span style="color: #ff0000;">（交付的时间要求，评估实施交付周期是否可行）</span></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">&bull;&nbsp;<strong>示例：</strong><br /><span style="color: #0000ff;">1、自项目签约后提供一年服务</span><br /><span style="color: #0000ff;">2、合同签订后12个月完成交付</span><br /><span style="color: #0000ff;">3、自合同签订生效之日起，服务周期24个月</span><br /><span style="color: #0000ff;">4、合同签订后60天内完成所有软件交付及初验</span></div>
</div>
</div>
<div>&nbsp;
<div id="Index_TB_deliveryRisk">
<div><strong>交付风险：</strong></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;"><span style="color: #ff0000;">&bull; 客户需求是否清晰、交付内容是否可行、交付周期是否可行。技术要求、系统要求、质量要求等是否可达成，需求范围是否清晰应答方案总体方案设计、系统架构设计、系统功能设计、部署实施方案等是否满足客户需求等是否满足客户需求</span><br /><br />评估要点：<br />1、是否存在时间，内容要求无法交付的<br />2、按要求交付项目成本是否覆盖<br />3、客户是否还有未明确的需求<br />4、是否存在其他交付困难<br />5、针对上述情况评估风险（高中低无），给出规避风险的方法描述</div>
<div style="margin-left: 40px;">&nbsp;</div>
<div style="margin-left: 40px;">&bull;&nbsp;<strong>示例：</strong><br />&bull;&nbsp;<strong>有风险：</strong><br /><span style="color: #0000ff;">1、经项目经理反馈，因本项目后项供应商尚未明确，在项目中标后合同签约前须确定合作供应商意向，否则项目存在较高交付风险</span><br /><span style="color: #0000ff;">2、经项目组评估可按客户要求时间周期完成交付，但事业部不具备同类项目的经验，存在较高交付风险</span><br /><span style="color: #0000ff;">3、经项目经理反馈，项目部分需求事业部无法满足交付要求，不具备自有产能的部分计划由合作伙伴协同交付，降低交付风险</span><br />&bull;&nbsp;<strong>无风险：</strong><br /><span style="color: #0000ff;">1、经项目经理反馈，由于项目已提前介入了解客户需求，经项目组评估可按客户要求时间周期完成交付，暂无交付周期的风险</span><br /><span style="color: #0000ff;">2、经项目组评估，此项目为延续性安全服务类项目，属于产能部门自有能力，暂无交付的风险</span></div>
<div>&nbsp;&nbsp;</div>
<div>
<div id="Index_TB_projectCooperationAssessment">
<div><strong>合作评估：</strong></div>
</div>
</div>
<div>&nbsp;</div>
<div style="margin-left: 40px;"><span style="color: #ff0000;">&bull; 邀请市场部项目合作评估师参会，对合作伙伴是否有风险进行评估把关、给出评估结论</span><br /><span style="color: #ff0000;">A角：高仲凯 B角：许海燕</span><br />&nbsp;</div>
<div style="margin-left: 40px;">&bull;&nbsp;<strong>示例：</strong>评估要点与采购风险要求一致，严禁自有能力合作等<br /><span style="color: #0000ff;">经项目组确认，本项目XXX事业部负责项目XXX工作/内容。XXX（需合作的内容，必须有出处，需核对客户需求清单，不能无中生有）工作/内容，因XXX原因（合作原因，客观有理有据，不能以客情作为合作依据），需要进行标前引入，经评估：本项目最终用户是 ICT 客户XXX，签约客户XXX，拟引入合作伙伴为XXXXX，我司与合作伙伴合作规模为XXX万元，合作内容为XXX，开标时间为XXXX年XX月XX日，能满足客户本项目的需求。经渠道部门、产能部门、市场部评估，建议选择方式是xxxxx（公开遴选，邀请遴选，公开方式，定向方式）。本项目非电信投资项目、前后向公司之间的股东不存在关联性关系，招标文件或前向合同无硬性要求相关资质；开标时间较紧，请项目组尽快提交合作引入材料</span></div>
</div>
</div>
<div>&nbsp;
<div id="Index_TB_maintenanceRequirements">
<div><strong>运维要求：</strong></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;"><span style="color: #ff0000;">&bull; 客户的响应时限、人员驻点、考核等工作要求和费用是否可满足；如有外采，需关注厂家提供的运维服务期与项目要求的服务期是否匹配。<br /><span style="color: #000000;">评估要点：</span></span><br />1、运维周期，运维人员数量、 职责、资质要求<br />2、运维要求是否明确<br />3、是否现场驻点或远程支撑<br />4、成本是否已经在考虑，包含在整体成本中<br />5、综合评估是否满足项目要求</div>
<div style="margin-left: 40px;">&nbsp;</div>
<div style="margin-left: 40px;">&bull;&nbsp;<strong>示例：</strong><br /><span style="color: #0000ff;">1、本项目招标文件的运维要求：本项目无运维要求，客户要求在终验后提供24个月保修期，为客户提供技术支撑、故障诊断支撑、远程及现场故障支撑及应急策略服务，经项目经理反馈，以上保修服务要求可满足，该成本已包含在预算中，暂无风险</span><br /><span style="color: #0000ff;">2、项目组反馈本项目暂不涉及验收后的运维相关工作</span></div>
</div>
<div>&nbsp;
<div id="Index_TB_trialRun">
<div><strong>试运行情况：</strong></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">&bull;&nbsp;<strong>示例：</strong><br /><span style="color: #0000ff;">1、项目组反馈该项目不需要试运行，不涉及试运行相关工作和风险</span><br /><span style="color: #0000ff;">2、本项目要求应用软件初验合格后进入试运行期。试运行期限为6个月。 项目组反馈可满足试运行要求，无试运行风险</span><br /><span style="color: #0000ff;">3、该项目预判不需要试运行，到明年8月底即可一次性验收，不涉及试运行相关工作和风险</span></div>
</div>
<div>&nbsp;
<div id="Index_TB_securityAssessment">
<div><strong>网络和信息安全评估：</strong>（主责系统）</div>
<div>&nbsp;</div>
<div style="margin-left: 40px;"><span style="color: #ff0000;">&bull;&nbsp;项目以系统形式存在需并且属亿迅公司主责</span>，上线阶段由综合办将组织独立评审，涵盖安全纳管、渗透测试、风险评估、定级备案等。<br /><span style="color: #ff0000;">&bull;&nbsp;同时邀请运营管理部/研发与质量管理中心、安全事业部：吴中华、陆艺阳参会，会上评估后给出结论</span></div>
</div>
<div>&nbsp;
<div id="Index_TB_maintenanceAssessment">
<div><strong>运维服务评估意见：</strong></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;"><span style="color: #ff0000;">&bull; 邀请运营管理部/研发与质量管理中心参会，会上评估后给出结论<br />A角：熊俊伟 B角：蒋朝豪</span></div>
</div>
<div>&nbsp;&nbsp;
<div id="Index_TB_testingRequirements">
<div><strong>等保测评、第三方测评要求：</strong>（谁负责、成本是否可覆盖）</div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">&bull;&nbsp;平台、软硬件、机房等相关安全性要求，项目是否有第三方测评、安全等保等要求，是否包含相关成本费用<br />&bull;&nbsp;示例：<br /><span style="color: #0000ff;">1、本项目不涉及等保测评、第三方测评要求和成本</span><br /><span style="color: #0000ff;">2、本项目不涉及等保测评。涉及第三方测评要求，测评费用未明确承担单位，存在风险</span></div>
</div>
</div>
<div>&nbsp;
<div id="Index_Index_TB_financialAssessment">
<div><strong>财务评估：</strong><span style="color: #ff0000;">财务部50万以上项目参加投标评估会，BC类不涉及外采的<span style="color: #000000;"><strong>刘椰韵</strong></span>参加，SM的<span style="color: #000000;"><strong>钟晓华</strong></span>，其他情况<strong><span style="color: #000000;">戴亮</span></strong>参加。</span></div>
</div>
<div>&nbsp;</div>
<div>&nbsp;&nbsp;</div>
</div>
<hr />
<h3 id="index_jd" style="color: #d9534f;">项目交底会</h3>
<div>
<div>&nbsp;
<div>
<div id="Index_JD_businessType">
<div><strong>业务类型：</strong></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">服务运营类：按周期提供服务<br />软件研发类：按客户要求进行软件研发。交付自有能力产品<br />大集成项目：见定义</div>
</div>
</div>
</div>
<div>&nbsp;
<div><strong>大集成类项目的定义：</strong></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">1、集成部按产能净收的6%收取项目管理费，扣减产能净收、计入集成部净收<br />2、面向电信公司、电信内部门、体系内专业公司的项目，原则上不定义为集成类项目，如由集成部牵头，需由商机评估会确认<br />3、面向行业客户的项目，2个或以上产能部门参与的，原则上定义为集成类项目，由集成部牵头<br />4、面向行业客户的项目，涉及单产能的，外包比例&gt;50%的，原则上定义为集成类项目，由集成部牵头。</div>
</div>
<div>&nbsp;</div>
<div><span style="color: #ff0000;"><strong>重点针对投标评估会涉及的风险是否得到解决&mdash;可直接把投标评估会中的风险点复制粘贴过来后逐一应答；中标后是否有新增的其他风险）【复制原来投标会确认的风险，评估是否已解除风险或风险还存在，项目经理再次确认】</strong></span></div>
<div>&nbsp;</div>
<div>
<div>
<div id="Index_JD_deliveryPeriod">
<div><strong>交付周期：</strong><span style="color: #ff0000;">（交付的时间要求，评估实施交付周期是否可行）</span></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">&bull;&nbsp;<strong>示例：</strong><br /><span style="color: #0000ff;">1、自项目签约后提供一年服务</span><br /><span style="color: #0000ff;">2、合同签订后12个月完成交付</span><br /><span style="color: #0000ff;">3、自合同签订生效之日起，服务周期24个月</span><br /><span style="color: #0000ff;">4、合同签订后60天内完成所有软件交付及初验</span></div>
</div>
</div>
<div>&nbsp;
<div id="Index_JD_deliveryRisk">
<div><strong>交付风险：</strong></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;"><span style="color: #ff0000;">&bull; 客户需求是否清晰、交付内容是否可行、交付周期是否可行。技术要求、系统要求、质量要求等是否可达成，需求范围是否清晰应答方案总体方案设计、系统架构设计、系统功能设计、部署实施方案等是否满足客户需求等是否满足客户需求</span><br /><br />评估要点：<br />1、是否存在时间，内容要求无法交付的<br />2、按要求交付项目成本是否覆盖<br />3、客户是否还有未明确的需求<br />4、是否存在其他交付困难<br />5、针对上述情况评估风险（高中低无），给出规避风险的方法描述</div>
<div style="margin-left: 40px;">&nbsp;</div>
<div style="margin-left: 40px;">&bull;&nbsp;<strong>示例：</strong><br />&bull;&nbsp;<strong>有风险：</strong><br /><span style="color: #0000ff;">1、经项目经理反馈，因本项目后项供应商尚未明确，在项目中标后合同签约前须确定合作供应商意向，否则项目存在较高交付风险</span><br /><span style="color: #0000ff;">2、经项目组评估可按客户要求时间周期完成交付，但事业部不具备同类项目的经验，存在较高交付风险</span><br /><span style="color: #0000ff;">3、经项目经理反馈，项目部分需求事业部无法满足交付要求，不具备自有产能的部分计划由合作伙伴协同交付，降低交付风险</span><br />&bull;&nbsp;<strong>无风险：</strong><br /><span style="color: #0000ff;">1、经项目经理反馈，由于项目已提前介入了解客户需求，经项目组评估可按客户要求时间周期完成交付，暂无交付周期的风险</span><br /><span style="color: #0000ff;">2、经项目组评估，此项目为延续性安全服务类项目，属于产能部门自有能力，暂无交付的风险</span></div>
</div>
</div>
&nbsp;</div>
<div>&nbsp;</div>
<div>
<div id="Index_JD_maintenanceRequirements">
<div><strong>运维要求：</strong></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;"><span style="color: #ff0000;">&bull; 客户的响应时限、人员驻点、考核等工作要求和费用是否可满足；如有外采，需关注厂家提供的运维服务期与项目要求的服务期是否匹配。<br /><span style="color: #000000;">评估要点：</span></span><br />1、运维周期，运维人员数量、 职责、资质要求<br />2、运维要求是否明确<br />3、是否现场驻点或远程支撑<br />4、成本是否已经在考虑，包含在整体成本中<br />5、综合评估是否满足项目要求</div>
<div style="margin-left: 40px;">&nbsp;</div>
<div style="margin-left: 40px;">&bull;&nbsp;<strong>示例：</strong><br /><span style="color: #0000ff;">1、本项目招标文件的运维要求：本项目无运维要求，客户要求在终验后提供24个月保修期，为客户提供技术支撑、故障诊断支撑、远程及现场故障支撑及应急策略服务，经项目经理反馈，以上保修服务要求可满足，该成本已包含在预算中，暂无风险</span><br /><span style="color: #0000ff;">2、项目组反馈本项目暂不涉及验收后的运维相关工作</span></div>
</div>
<div>&nbsp;
<div id="Index_JD_trialRun">
<div><strong>试运行情况：</strong></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">&bull;&nbsp;<strong>示例：</strong><br /><span style="color: #0000ff;">1、项目组反馈该项目不需要试运行，不涉及试运行相关工作和风险</span><br /><span style="color: #0000ff;">2、本项目要求应用软件初验合格后进入试运行期。试运行期限为6个月。 项目组反馈可满足试运行要求，无试运行风险</span><br /><span style="color: #0000ff;">3、该项目预判不需要试运行，到明年8月底即可一次性验收，不涉及试运行相关工作和风险</span></div>
</div>
<div>&nbsp;&nbsp;
<div>
<div id="Index_JD_maintenanceAssessment">
<div><strong>运维服务评估意见：</strong></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;"><span style="color: #ff0000;">&bull; 邀请运营管理部/研发与质量管理中心参会，会上评估后给出结论<br />A角：熊俊伟 B角：蒋朝豪</span></div>
</div>
<div>&nbsp;&nbsp;
<div id="Index_JD_testingRequirements">
<div><strong>等保测评、第三方测评要求：</strong>（谁负责、成本是否可覆盖）</div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">&bull;&nbsp;平台、软硬件、机房等相关安全性要求，项目是否有第三方测评、安全等保等要求，是否包含相关成本费用<br />&bull;&nbsp;示例：<br /><span style="color: #0000ff;">1、本项目不涉及等保测评、第三方测评要求和成本</span><br /><span style="color: #0000ff;">2、本项目不涉及等保测评。涉及第三方测评要求，测评费用未明确承担单位，存在风险</span></div>
</div>
<div>&nbsp;&nbsp;&nbsp;
<div id="Index_JD_publicPlatform">
<div><span style="color: #ff0000;"><strong>公共架构评估：</strong></span></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">&bull;&nbsp;按部门邀请运营管理部/研发与质量管理中心评估专员参会评估<span style="color: #ff0000;">【必须参会】</span><br />IT系统事业部：王沛文、高航<br />
大数据AI应用事业部：许智洋<br />
数字政府事业部：李佳鑫、许伟明<br />
云网事业部：许智洋<br />
智呼事业部：郑辉<br />
智慧企业集成事业部：郑辉、陈家辉<br />
智慧网络运营事业部：周宏江、高航、许伟明<br />
智慧业财事业部：王沛文</div>
</div>
</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>
<hr />
 <h3 id="index_others" style="color: #d9534f;">其他情况：</h3>
<div><span style="color: #ff0000;"><strong>可填写新增风险，项目变更，特殊情况说明等。如无则留空</strong></span></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;"><span style="color: #000000;">&bull; <strong>示例</strong></span><br /><span style="color: #0000ff;">1、XXX事业部云XXX团队反馈暂无高级项目经理，本项目的项目经理由XXX担任</span><br /><span style="color: #0000ff;">2、项目涉及XXX内容变更，请项目组在MSS系统进行项目变更流程，流程审批通过后方可执行变更</span><br /><span style="color: #0000ff;">3、项目组评估本项目涉及提前采购，需走呈批流程汇报申请，根据结果判断可否提前采购</span><br /><span style="color: #0000ff;">4、项目利润率为-xx%，存在亏损情况，请项目组按公司经济事项审批权限要求，进行上会决策，按决策要求确认商机是否跟进</span><br /><span style="color: #0000ff;">5、本期项目合同约定建设内容为XXXX，本次采购XXXX需求，无对应的销售项清单。若本项目需采购XXX请项目组提请公司呈批同意</span></div>
</div>
<div>&nbsp;</div>
<hr />
<h3 id="index_other_info" style="color: #d9534f;">其他核对要点：</h3>
<div>&nbsp;
<div>
<div><span style="color: #ff0000;"><strong>其他及非纪要内容核对（公共）</strong></span></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">1、项管系统中各部门份额，人工成本B类成本均需核对是否与纪要一致<br />2、其他项管系统选项均要核查一一细看，以免出错<br />3、自动生成纪要需通篇审阅，不要出现语病，前后矛盾，系统不一致的问题<br />4、差额列收项目，系统上：预算按合同额写，外采预算按合作分成金额写<br />会议纪要结论明确差额列收方式，实际列收金额，虽然系统外采预算按合作分成外采填报，但纪要结论&ldquo;外采预算&rdquo;按&ldquo;无&rdquo;处理，&ldquo;外采内容&rdquo;按实际写<br />5、属于关键技术及自有核心能力的，如需外包，产能部门需在发起商机评估会前，先经过公司科创部、运营管理部/研发与质量管理中心、市场部前置评审。【钉钉流程】，如未通过评审，不得外采</div>
</div>
<div>&nbsp;</div>
</div>
<div>
<div>
<div><strong><span style="color: #ff0000;">其他及非纪要内容核对（投标评估会）</span></strong></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">1、虚假贸易（若属于行业域项目）：项目管理系统上对应项逐一核对<br />2、各项保证金是否超出以下限制：投标保证金支付金额不超过投标报价的2%，履约保证金支付金额不超过业务合同总额的10%，质量保证金支付金额不超过业务合同总额的 5%，预付款保证金支付金额不超过业务合同总额的15%与预付款的孰低值。<br />提醒：对于保证金支付金额超出上限规定的，采取一事一议的原则，由使用部门提交总经理办公会进行决策。</div>
</div>
<div>&nbsp;
<div>
<div><span style="color: #ff0000;"><strong>其他及非纪要内容核对（项目交底会）</strong></span></div>
<div>&nbsp;</div>
<div style="margin-left: 40px;">1、项管系统中MSS商机编码证明材料要下载，核对是否跟系统MSS商机编码一致<br />2、项目合同履约信息项目进度款、初验款、终验款等阶段要跟项目实际情况匹配，计划完成、列账、回款时间要符合先后逻辑。务必跟项目组一一核对<br />3、干系人清单确认是否合理</div>
</div>
<div>&nbsp;</div>
</div>
</div>


<div style="margin-left: 40px;">集成项目涉及代收代付业务的项目流程建议：<br />
1、项目招标前，建议项目组尽力引导客户非公司许可类经营业务范围内业务（主要指基础电信业务）在招标文件中写明采用代收代付模式。<br />
2、销售经理获取招标文件后，项目组需仔细阅读标书，识别非公司许可类经营业务范围内业务（主要指基础电信业务），并积极主动与招标方或直接客户沟通，确认客户是否可接受采用代收代付模式投标。<br />
3、项目投标评估会：涉及超公司许可类经营范围的事项，建议邀请公司法律合规部同事参会。如客户确认可采用代收代付方式投标，则需在投标评估会会议纪要里，明确写清楚本项目采用代收代付方式，由电信直接开发票给客户。同时，建议拿到电信方提供的相关业务授权后以电信业务代理方身份参与项目投标。如客户确认不可采用代收代付方式投标，因项目相关建设内容超公司许可类经营范围，建议项目组升级汇报（部门经理、公司领导层等），申请决策是否参与项目投标。
4、编制项目投标文件时，建议在项目投标文件显眼处（如项目报价表等）写明：我司是电信业务代理方，实际由XX电信方提供服务并直接向客户开具相应电信服务的发票。注意：我司必须先拿到电信方授权才能按上述文字描述。<br />
5、项目中标后，需要在项目交底会会议纪要上明确采用代收代付模式；同时，在前向合同签约时明确写明：公司作为电信业务代理方，为客户代购电信业务的条款。及基于电信代理的性质，由电信服务商直接向客户开具相应电信服务的发票。前向合同由我司与客户直接签约。<br />
6、综上所述，基于项目合同已约定要求电信服务商直接向客户开具发票，在流程上，公司不产生开票和列账。基础电信业务类型的代收代付实际不涉及收入和成本，可视为无收支合同。故代收代付模式付款时，建议采用三方或两方协议方式（亿迅-电信方-客户/亿迅-电信）（无收支合同）的方式，发起合同审批时，请业务部门在审批流程里加签市场部审批；在报账付款时，将合同或合同关键页作为附件发起报账付款流程。<br />
7、其他特殊情况建议一项目一议。</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>&nbsp;</p>
    `;

    // ======================= ELEMENT SELECTORS (DOM Cache) =======================
    const DOMElements = {
        // Main Form
        mainForm: document.getElementById('main-form'),
        ironTriangleInput: document.getElementById('ironTriangleInput'),
        projectLevel: document.getElementById('projectLevel'),
        budgetAmount: document.getElementById('budgetAmount'),
        
        // UI Interaction Elements
        procurement: document.getElementById('procurement'),
        procurementAmount: document.getElementById('procurementAmount'),
        procurementRiskRow: document.getElementById('procurementRiskRow'),
        coreCapability: document.getElementById('coreCapability'),
        coreCapabilityWarning: document.getElementById('coreCapabilityWarning'),
        capacityType: document.getElementById('capacityType'),
        deliveryDetailsTable: document.getElementById('deliveryDetailsTable'),
        
        SJ_projectCooperationNeeded: document.getElementById('SJ_projectCooperationNeeded'),
        SJ_projectCooperationAssessmentRow: document.getElementById('SJ_projectCooperationAssessmentRow'),
        SJ_preInvestmentNeeded: document.getElementById('SJ_preInvestmentNeeded'),
        SJ_preInvestmentDetailsRow: document.getElementById('SJ_preInvestmentDetailsRow'),
        
        TB_biddingMethod: document.getElementById('TB_biddingMethod'),
        TB_bidOpeningDate: document.getElementById('TB_bidOpeningDate'),
        TB_bidResponseDate: document.getElementById('TB_bidResponseDate'),
        TB_biddingRiskRow: document.getElementById('TB_biddingRiskRow'),
        TB_projectCooperationNeeded: document.getElementById('TB_projectCooperationNeeded'),
        TB_projectCooperationAssessmentRow: document.getElementById('TB_projectCooperationAssessmentRow'),
        TB_isPrimarySystem: document.getElementById('TB_isPrimarySystem'),
        TB_securityAssessmentRow: document.getElementById('TB_securityAssessmentRow'),
        
        JD_biddingMethod: document.getElementById('JD_biddingMethod'),
        JD_bidOpeningDate: document.getElementById('JD_bidOpeningDate'),
        JD_bidResponseDate: document.getElementById('JD_bidResponseDate'),
        JD_awardDate: document.getElementById('JD_awardDate'),
        
        // Help Panel
        helpContent: document.querySelector('.help-content'),

        // Modals
        reportModal: document.getElementById('report-modal'),
        reportTitle: document.getElementById('report-title'),
        reportText: document.getElementById('report-text'),

        pmQueryModal: document.getElementById('pm-query-modal'),
        pmAutoResult: document.getElementById('pm-auto-result'),
        pmSearchInput: document.getElementById('pm-search-input'),
        pmDeptFilter: document.getElementById('pm-dept-filter'),
        pmFullTableBody: document.getElementById('pm-full-table').querySelector('tbody'),

        attendeesModal: document.getElementById('attendees-modal'),
        attendeesForm: document.querySelector('#attendees-modal .attendees-form'),
        attendeesOutput: document.getElementById('attendees-output'),

        emailModal: document.getElementById('email-modal'),
        emailChecklist: document.getElementById('email-checklist'),
        emailOutput: document.getElementById('email-output'),
    };

    // ======================= INITIALIZATION =======================
    
    // Inject Help HTML
    DOMElements.helpContent.innerHTML = HELP_HTML;

    // Create Delivery Details Table Rows
    const tableBody = DOMElements.deliveryDetailsTable.querySelector('tbody');
    const verticalHeaders = ['牵头交付事业部', ...Array.from({length: 7}, (_, i) => `协助交付事业部${i + 1}`)];
    const deptOptions = ["", "IT系统事业部", "大数据AI应用事业部", "数字政府事业部", "云网事业部", "智呼事业部", "智慧企业集成事业部", "智慧网络运营事业部", "智慧业财事业部"];

    verticalHeaders.forEach(headerText => {
        const row = tableBody.insertRow();
        row.innerHTML = `
            <th>${headerText}</th>
            <td><select class="table-dept-select">${deptOptions.map(opt => `<option value="${opt}">${opt}</option>`).join('')}</select></td>
            <td><input type="text"></td>
            <td><input type="text"></td>
            <td><input type="text"></td>
        `;
    });

    // ======================= UI INTERACTIVITY LOGIC =======================
    
    function setupConditionalVisibility(selectId, rowId) {
        const select = document.getElementById(selectId);
        const row = document.getElementById(rowId);
        select.addEventListener('change', () => {
            const shouldShow = (select.value === '是');
            row.style.display = shouldShow ? '' : 'none';
            if (!shouldShow) {
                const textarea = row.querySelector('textarea');
                if (textarea) textarea.value = '';
            }
        });
    }

    DOMElements.procurement.addEventListener('change', () => {
        const isProcurement = DOMElements.procurement.value === '是';
        DOMElements.procurementAmount.disabled = !isProcurement;
        DOMElements.coreCapability.disabled = !isProcurement;
        DOMElements.procurementRiskRow.style.display = isProcurement ? '' : 'none';
        if (!isProcurement) {
            DOMElements.coreCapability.value = '';
            DOMElements.coreCapabilityWarning.style.display = 'none';
            DOMElements.procurementAmount.value = '';
            document.getElementById('procurementRisk').value = '';
        }
    });

    DOMElements.coreCapability.addEventListener('change', () => {
        DOMElements.coreCapabilityWarning.style.display = (DOMElements.coreCapability.value === '是') ? '' : 'none';
    });

    DOMElements.capacityType.addEventListener('change', () => {
        const showTable = ['多产能', '大集成'].includes(DOMElements.capacityType.value);
        DOMElements.deliveryDetailsTable.style.display = showTable ? 'table' : 'none';
    });

    setupConditionalVisibility('SJ_projectCooperationNeeded', 'SJ_projectCooperationAssessmentRow');
    setupConditionalVisibility('SJ_preInvestmentNeeded', 'SJ_preInvestmentDetailsRow');
    setupConditionalVisibility('TB_projectCooperationNeeded', 'TB_projectCooperationAssessmentRow');
    setupConditionalVisibility('TB_isPrimarySystem', 'TB_securityAssessmentRow');

    function updateBiddingFields(methodSelectId) {
        const method = document.getElementById(methodSelectId).value;
        const isTB = methodSelectId.startsWith('TB');
        const openDateEl = document.getElementById(isTB ? 'TB_bidOpeningDate' : 'JD_bidOpeningDate');
        const responseDateEl = document.getElementById(isTB ? 'TB_bidResponseDate' : 'JD_bidResponseDate');
        const awardDateEl = document.getElementById('JD_awardDate');
        const riskRowEl = document.getElementById('TB_biddingRiskRow');

        const openMethods = ["公开招标", "邀请招标", "比选"];
        const responseMethods = ["单一来源", "询价", "竞争性谈判"];
        
        const isOpen = openMethods.includes(method);
        const isResponse = responseMethods.includes(method);
        
        openDateEl.disabled = !isOpen;
        responseDateEl.disabled = !isResponse;
        if(isTB && riskRowEl) riskRowEl.style.display = isOpen ? '' : 'none';
        if(!isTB && awardDateEl) awardDateEl.disabled = !isOpen;
    };
    
    DOMElements.TB_biddingMethod.addEventListener('change', () => updateBiddingFields('TB_biddingMethod'));
    DOMElements.JD_biddingMethod.addEventListener('change', () => updateBiddingFields('JD_biddingMethod'));

    // ======================= FIELD SYNCHRONIZATION =======================
    const syncPairs = {
        'SJ_grossMargin': 'TB_grossMargin', 'TB_grossMargin': 'SJ_grossMargin',
        'SJ_projectCooperationAssessment': 'TB_projectCooperationAssessment', 'TB_projectCooperationAssessment': 'SJ_projectCooperationAssessment',
        'SJ_projectCooperationNeeded': 'TB_projectCooperationNeeded', 'TB_projectCooperationNeeded': 'SJ_projectCooperationNeeded',
        'TB_businessType': 'JD_businessType', 'JD_businessType': 'TB_businessType',
        'TB_biddingMethod': 'JD_biddingMethod', 'JD_biddingMethod': 'TB_biddingMethod',
        'JD_deliveryPeriod': 'TB_deliveryPeriod', 'TB_deliveryPeriod': 'JD_deliveryPeriod',
        'JD_deliveryRisk': 'TB_deliveryRisk', 'TB_deliveryRisk': 'JD_deliveryRisk',
        'JD_maintenanceRequirements': 'TB_maintenanceRequirements', 'TB_maintenanceRequirements': 'JD_maintenanceRequirements',
        'JD_trialRun': 'TB_trialRun', 'TB_trialRun': 'JD_trialRun',
        'JD_maintenanceAssessment': 'TB_maintenanceAssessment', 'TB_maintenanceAssessment': 'JD_maintenanceAssessment',
        'JD_testingRequirements': 'TB_testingRequirements', 'TB_testingRequirements': 'JD_testingRequirements',
    };
    
    let isSyncing = false;
    
    Object.keys(syncPairs).forEach(sourceId => {
        const sourceEl = document.getElementById(sourceId);
        sourceEl.addEventListener('change', () => { // Use 'change' for selects, works for inputs too
            if (isSyncing) return;
            isSyncing = true;
            const targetEl = document.getElementById(syncPairs[sourceId]);
            if (targetEl) {
                targetEl.value = sourceEl.value;
                targetEl.dispatchEvent(new Event('change', { bubbles: true }));
            }
            isSyncing = false;
        });
        sourceEl.addEventListener('input', () => { // Use 'input' for live typing in text fields
            if (isSyncing || sourceEl.tagName === 'SELECT') return;
             isSyncing = true;
            const targetEl = document.getElementById(syncPairs[sourceId]);
            if (targetEl) targetEl.value = sourceEl.value;
            isSyncing = false;
        });
    });

    // ======================= CORE LOGIC (from logic_1.py) =======================

    function _safeFloat(value, defaultValue = 0.0) {
        const num = parseFloat(value);
        return isNaN(num) ? defaultValue : num;
    }

    function _ensurePeriod(text) {
        text = String(text || '').trim();
        if (!text) return "";
        return (text.endsWith('。') || text.endsWith('.')) ? text : text + '。';
    }

    function _formatDate(dateStr) {
        try {
            const dt = new Date(dateStr);
            if (isNaN(dt.getTime())) return dateStr;
            return `${dt.getFullYear()}年${dt.getMonth() + 1}月${dt.getDate()}日`;
        } catch (e) {
            return dateStr;
        }
    }



    function _formatProjectRoles(inputText) {
        if (!inputText) return "【铁三角信息未填写】。";
        const roles = {};
        // --- 修改后的正则表达式 ---
        const pattern = /(.+?)\s*[:：]\s*(.+?)\s*[(（](.+?)[)）]/gs; 
        // --- 修改结束 ---
        let match;
        while ((match = pattern.exec(inputText.trim())) !== null) {
            // Trim potential extra spaces around names and departments
            roles[match[1].trim()] = { name: match[2].trim(), department: match[3].trim() };
        }
        const getInfo = (role) => roles[role] || { name: "【待定】", department: "【待定】" };
        const pm = getInfo("项目经理"), sales = getInfo("销售经理"), solution = getInfo("方案经理"), delivery = getInfo("交付经理");
        // Ensure department is captured correctly even if name extraction failed slightly
        if (!pm.department && roles["项目经理"]?.department) pm.department = roles["项目经理"].department;
        if (!sales.department && roles["销售经理"]?.department) sales.department = roles["销售经理"].department;
        if (!solution.department && roles["方案经理"]?.department) solution.department = roles["方案经理"].department;
        if (!delivery.department && roles["交付经理"]?.department) delivery.department = roles["交付经理"].department;
        
        return `项目经理是${pm.name}(${pm.department})，销售经理是${sales.name}(${sales.department})，方案经理是${solution.name}(${solution.department})，交付经理是${delivery.name}(${delivery.department})。`;
    }

    function gatherFormData() {
        const data = {};
        const form = DOMElements.mainForm;
        const inputs = form.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            if (input.id) data[input.id] = input.value;
        });
        
        const table_data = [];
        const rows = DOMElements.deliveryDetailsTable.querySelector('tbody').rows;
        for(let i=0; i<rows.length; i++) {
            const row = rows[i];
            const dept = row.cells[1].querySelector('select').value;
            if(!dept) continue;

            table_data.push({
                '类型': row.cells[0].innerText,
                '事业部': dept,
                '项目经理': row.cells[2].querySelector('input').value,
                '交付内容': row.cells[3].querySelector('input').value,
                '预算（万元）': row.cells[4].querySelector('input').value
            });
        }
        data['deliveryDetails'] = table_data;
        return data;
    }

    function _calculateCommonLogic(formData) {
        const budgetYuan = _safeFloat(formData.budgetAmount);
        const procurementYuan = _safeFloat(formData.procurementAmount);
        const budgetWan = budgetYuan / 10000;
        const procurementWan = procurementYuan / 10000;
        const procurementRatio = (budgetWan !== 0) ? (procurementWan / budgetWan) : 0.0;
        
        let leadDepartment = "【未知事业部】";
        const tjsRawText = formData.ironTriangleInput || '';
        // --- 修改后的正则表达式 ---
        const pmPattern = /项目经理\s*[:：]\s*(?:.+?)\s*[(（](.+?)[)）]/s;
        // --- 修改结束 ---
        const pmMatch = tjsRawText.match(pmPattern);
        if (pmMatch && pmMatch[1]) {
             leadDepartment = pmMatch[1].trim();
        }

        const tjsSummary = _formatProjectRoles(tjsRawText); // Uses the updated function from Step 1

        // Delivery details summaries (logic remains the same)

        let assistDepartmentsSummary = '';
        let deliverySummary = '';
        const deliveryDetails = formData.deliveryDetails || [];
        if (formData.capacityType !== '单产能' && deliveryDetails.length > 0) {
            const assistDepts = deliveryDetails
                .filter(row => row['类型'] !== '牵头交付事业部' && row['事业部'])
                .map(row => row['事业部'].trim());
            if (assistDepts.length > 0) assistDepartmentsSummary = `${assistDepts.join('、')}协助交付。`;

            deliverySummary = '\n' + deliveryDetails.map((row, index) => {
                let currentPart = `${row['事业部']}`;
                if (row['交付内容']) currentPart += `负责交付${row['交付内容']}`;
                const budgetVal = _safeFloat(row['预算（万元）']);
                if (budgetVal > 0) currentPart += `，预算${budgetVal.toFixed(2)}万元`;
                if (row['项目经理']) {
                    const managerRole = row['类型'] === '牵头交付事业部' ? '项目经理' : '子项目经理';
                    currentPart += `，${managerRole}是${row['项目经理']}`;
                }
                return `${index + 1}）${currentPart}`;
            }).join('；\n') + '。';
        }

        return {
            budget_in_wan: budgetWan,
            procurement_in_wan: procurementWan,
            procurement_ratio: procurementRatio,
            lead_department: leadDepartment,
            tjs_summary: tjsSummary,
            assist_departments_summary: assistDepartmentsSummary,
            delivery_summary: deliverySummary
        };
    }
    
    // --- Generate Opportunity Minutes ---
    function generateOpportunityMinutes(formData) {
        const common = _calculateCommonLogic(formData);
        const temp = {...formData, ...common};
        const getVal = (key, placeholder) => temp[key]?.trim() || placeholder;

        const projectName = getVal('projectName', "【请补充项目名称】");
        const businessCode = getVal('businessCode', "【请补充项目商机编码】");
        const constructionContent = getVal('constructionContent', "【请补充建设内容】");
        const capacityType = getVal('capacityType', "【请选择产能能力】");
        const projectLevel = getVal('projectLevel', "【请选择项目级别】");
        const SJ_projectRisk = `本项目存在风险：\n${getVal('SJ_projectRisk', "【请补充项目风险（商机）】")}`;
        const OT_risk = getVal('OT_risk');
        
        const clientDescription = !temp.contractClient  ? "【请补充签约客户】"
          : `项目签约客户是${temp.contractClient}` 
          + ((!temp.endClient || temp.endClient === temp.contractClient) ? '。'
          : `，最终客户是${temp.endClient}。`);

        let procurement_text = temp.procurement === '是' ? `涉及外采，外采预算${temp.procurement_in_wan.toFixed(2)}万元（含税），`
            : temp.procurement === '否' ? '不涉及外采，' : '【请选择是否后向外采】，';
        
        let procurementRisk = temp.procurement === '是' ? getVal('procurementRisk', "【请补充外采风险】")
            : temp.procurement === '否' ? "本项目不涉及外采" : "【请评估是否涉及外采】";
        
        let SJ_projectCooperationAssessment = temp.SJ_projectCooperationNeeded === '是' ? getVal('SJ_projectCooperationAssessment', "【请补充项目合作评估】")
            : temp.SJ_projectCooperationNeeded === '否' ? "本项目不涉及项目合作" : "【请评估是否项目合作】";
        
        let SJ_preInvestmentDetails = temp.SJ_preInvestmentNeeded === '是' ? getVal('SJ_preInvestmentDetails', "【请补充预投入情况】")
            : temp.SJ_preInvestmentNeeded === '否' ? "本项目不涉及预投入情况" : "【请评估是否涉及预投入】";

        const SJ_atomicCapability = getVal('SJ_atomicCapability', "【请补充原子能力评估】");



        
        const key1_text = `本项目是${projectName}，项目签约客户是${clientDescription}项目建设内容为${constructionContent}`;
        const key2_text = `本项目属于${capacityType}${projectLevel}项目，由${temp.lead_department}牵头，${temp.assist_departments_summary}${temp.tjs_summary}${temp.delivery_summary}`;
        const key3_text = `本项目预算${temp.budget_in_wan.toFixed(2)}万元（含税），${procurement_text}毛利率预估${_safeFloat(temp.SJ_grossMargin).toFixed(2)}%（不含税），利润率预估${_safeFloat(temp.SJ_netMargin).toFixed(2)}%（不含税）`;

        let output = `${projectName}（${businessCode}）\n\n商机评估会\n`;
        const points = [key1_text, key2_text, key3_text, SJ_projectRisk, procurementRisk, SJ_projectCooperationAssessment, SJ_preInvestmentDetails, SJ_atomicCapability, OT_risk];
        
        let counter = 1;
        points.forEach(p => {
            if (p && String(p).trim()) {
                output += `${counter}、${_ensurePeriod(p)}\n`;
                counter++;
            }
        });
        output += "综合评估各要素，铁三角成员评估跟进此商机。";
        return output;
    }

    // --- Generate Bidding Minutes ---
    function generateBiddingMinutes(formData) {
        const common = _calculateCommonLogic(formData);
        const temp = {...formData, ...common};
        const getVal = (key, placeholder) => temp[key]?.trim() || placeholder;

        const projectName = getVal('projectName', "【请补充项目名称】");
        const businessCode = getVal('businessCode', "【请补充项目商机编码】");
        const TB_businessType = getVal('TB_businessType', "【请补充业务类型】");
        const constructionContent = getVal('constructionContent', "【请补充建设内容】");
        const capacityType = getVal('capacityType', "【请选择产能能力】");
        const projectLevel = getVal('projectLevel', "【请选择项目级别】");
        const TB_deliveryPeriod = getVal('TB_deliveryPeriod', "【请补充交付周期】");
        const TB_deliveryRisk = getVal('TB_deliveryRisk', "【请补充交付风险】");
        const TB_maintenanceRequirements = getVal('TB_maintenanceRequirements', "【请补充运维要求】");
        const TB_maintenanceAssessment = getVal('TB_maintenanceAssessment', "【请补充运维服务评估意见】");
        const TB_financialAssessment = getVal('TB_financialAssessment', "【请补充财务评估】");
        const TB_testingRequirements = getVal('TB_testingRequirements', "【请补充等保测评、第三方测评要求】");
        const TB_trialRun = getVal('TB_trialRun', "【请补充试运行情况】");
        const OT_risk = getVal('OT_risk');
        const TB_biddingRisk = getVal('TB_biddingRisk', "【请补充招投标风险评估】");

        const clientDescription = !temp.contractClient  ? "【请补充签约客户】"
          : `项目签约客户是${temp.contractClient}` 
          + ((!temp.endClient || temp.endClient === temp.contractClient) ? '。'
          : `，最终客户是${temp.endClient}。`);
        

        const bidMethodsWithRisk = ["公开招标", "邀请招标", "比选"];
        const bid_method_desc = (method => {
            if (!method) return "【请选择投标方式】";
            const entity = getVal('TB_biddingEntity', '【请选择投标主体】');
            if (bidMethodsWithRisk.includes(method)) return `${method}方式，拟以${entity}名义投标，开标时间为${_formatDate(temp.TB_bidOpeningDate)}`;
            if (["单一来源", "询价", "竞争性谈判"].includes(method)) return `${method}方式，拟以${entity}名义应答，应答时间为${_formatDate(temp.TB_bidResponseDate)}`;
            return method;
        })(temp.TB_biddingMethod);

        const risk_assessment_desc = bidMethodsWithRisk.includes(temp.TB_biddingMethod) ? TB_biddingRisk
            : (temp.TB_biddingMethod ? `本项目客户采用${temp.TB_biddingMethod}方式，不涉及招投标风险` : "【请选择投标方式】");

        const procurement_text = temp.procurement === '是' ? `涉及外采，外采预算${temp.procurement_in_wan.toFixed(2)}万元（含税），外采占比${temp.procurement_ratio.toLocaleString(undefined, {style: 'percent', minimumFractionDigits: 2})}，`
            : temp.procurement === '否' ? '不涉及外采，' : '【请选择是否后向外采】，';

        const procurementRisk = temp.procurement === '是' ? getVal('procurementRisk', "【请补充外采风险】")
            : temp.procurement === '否' ? "本项目不涉及外采" : "【请评估是否涉及外采】";

        const TB_projectCooperationAssessment = temp.TB_projectCooperationNeeded === '是' ? getVal('TB_projectCooperationAssessment', "【请补充项目合作评估】")
            : temp.TB_projectCooperationNeeded === '否' ? "本项目不涉及项目合作" : "【请评估是否项目合作】";
            
        const TB_securityAssessment = temp.TB_isPrimarySystem === '是' ? getVal('TB_securityAssessment', "【请补充网络和信息安全评估】")
            : temp.TB_isPrimarySystem === '否' ? "本项目不涉及亿迅主责系统" : "【请评估是否亿迅主责系统】";

        const key1_text = `本项目为${TB_businessType}项目，项目签约客户是${clientDescription}客户计划采用${bid_method_desc}。`;
        const key2_text = `项目建设内容为：${constructionContent}。由${temp.lead_department}牵头，${temp.assist_departments_summary}${temp.tjs_summary}${temp.delivery_summary}`;
        const key3_text = `本项目预算${temp.budget_in_wan.toFixed(2)}万元（含税），属于${capacityType}${projectLevel}项目，${procurement_text}毛利率预估${_safeFloat(temp.TB_grossMargin).toFixed(2)}%（不含税）。`;
        const key4_text = `本项目交付要求：交付周期为${TB_deliveryPeriod}，${TB_deliveryRisk}`;

        let output = `${projectName}(${businessCode})\n\n投标评估会\n一、项目基本信息\n1、${key1_text}\n2、${key2_text}\n3、${key3_text}\n二、风险及应对措施\n`;
        
        const risk_points = [risk_assessment_desc, key4_text, procurementRisk, TB_projectCooperationAssessment, TB_maintenanceRequirements, TB_securityAssessment, TB_maintenanceAssessment, TB_financialAssessment, TB_testingRequirements, TB_trialRun, OT_risk];
        let counter = 1;
        risk_points.forEach(p => {
            if (p && String(p).trim()) {
                output += `${counter}、${_ensurePeriod(p)}\n`;
                counter++;
            }
        });
        
        output += "三、会议结论\n综合评估各要素，铁三角评估可参与此项目投标，并根据内控审批权限作投标审批决策。";
        return output;
    }

    // --- Generate Kickoff Minutes ---
    function generateKickoffMinutes(formData) {
        const common = _calculateCommonLogic(formData);
        const temp = {...formData, ...common};
        const getVal = (key, placeholder) => temp[key]?.trim() || placeholder;

        const projectName = getVal('projectName', "【请补充项目名称】");
        const businessCode = getVal('businessCode', "【请补充项目商机编码】");
        const JD_businessType = getVal('JD_businessType', "【请补充业务类型】");
        const constructionContent = getVal('constructionContent', "【请补充建设内容】");
        const capacityType = getVal('capacityType', "【请选择产能能力】");
        const projectLevel = getVal('projectLevel', "【请选择项目级别】");
        const JD_deliveryPeriod = getVal('JD_deliveryPeriod', "【请补充交付周期】");
        const JD_deliveryRisk = getVal('JD_deliveryRisk', "【请补充交付风险】");
        const JD_maintenanceRequirements = getVal('JD_maintenanceRequirements', "【请补充运维要求】");
        const JD_trialRun = getVal('JD_trialRun', "【请补充试运行情况】");
        const JD_maintenanceAssessment = getVal('JD_maintenanceAssessment', "【请补充运维服务评估意见】");
        const JD_testingRequirements = getVal('JD_testingRequirements', "【请补充等保测评、第三方测评要求】");
        const OT_risk = getVal('OT_risk');

        const clientDescription = !temp.contractClient  ? "【请补充签约客户】"
          : `项目签约客户是${temp.contractClient}` 
          + ((!temp.endClient || temp.endClient === temp.contractClient) ? '。'
          : `，最终客户是${temp.endClient}。`);

        // ========================[ 这里是您确认的最新逻辑 ]========================
        const bid_method_desc = (method => {
            if (!method) return "【请选择投标方式】";
            
            const open_date = _formatDate(temp.JD_bidOpeningDate);
            const award_date = _formatDate(temp.JD_awardDate);
            const signing_date = _formatDate(temp.JD_signingDate);
            const response_date = _formatDate(temp.JD_bidResponseDate);
    
            if (["公开招标", "邀请招标", "比选"].includes(method)) {
                return `${method}方式，开标时间为${open_date}，中标时间为${award_date}，计划${signing_date}前完成签约`;
            }
            if (method === "单一来源") {
                return `${method}方式，无需招投标，${response_date}已完成应答，计划${signing_date}前完成签约`;
            }
            if (["原子能力下单", "订单方式"].includes(method)) {
                return `${method}方式，预计客户在${signing_date}前完成下单`;
            }
            if (["询价", "竞争性谈判"].includes(method)) {
                return `${method}方式，${response_date}已完成应答，预计客户在${signing_date}前完成签约`;
            }
            if (["电商采购", "直接采购"].includes(method)) {
                return `${method}方式，预计客户在${signing_date}前完成签约`;
            }
            return method; // 其他情况直接返回方法名
        })(temp.JD_biddingMethod);
        // ======================================================================

        const procurement_text = temp.procurement === '是' ? `涉及外采，外采预算${temp.procurement_in_wan.toFixed(2)}万元（含税），外采占比${temp.procurement_ratio.toLocaleString(undefined, {style: 'percent', minimumFractionDigits: 2})}。`
            : temp.procurement === '否' ? '不涉及外采。' : '【请选择是否后向外采】，';
            
        const procurementRisk = temp.procurement === '是' ? getVal('procurementRisk', "【请补充外采风险】")
            : temp.procurement === '否' ? "本项目不涉及外采" : "【请评估是否涉及外采】";
        
        const key1_text = `本项目为${JD_businessType}项目，项目签约客户是${clientDescription}客户采用${bid_method_desc}。`;
        const key2_text = `本项目预算${temp.budget_in_wan.toFixed(2)}万元（含税），${procurement_text}`;
        const key3_text = `项目建设内容为：${constructionContent}。本项目属于${capacityType}${projectLevel}项目，由${temp.lead_department}牵头，${temp.assist_departments_summary}${temp.tjs_summary}${temp.delivery_summary}`;
        const key4_text = "1、项目售前资料交底：销售经理、方案经理已对项目所有售前的会议纪要、客户沟通记录、客户需求及交付要求等资料交接给交付经理、项目经理；\n2、项目投标资料交底：销售经理、方案经理已对招标文件、投标文件、技术规范书等资料交接给交付经理、项目经理；\n3、项目实施计划交底：项目经理已完成项目里程碑计划，各关键节点已有明确的交付成果要求，铁三角已确认该时间节点可行；\n4、项目干系人交底：销售经理已上传项目干系人清单，清单已包含客户（签约客户/最终客户）以及合作伙伴干系人的名单和联系方式，铁三角对项目干系人已知晓。";
        const key5_text = `本项目交付要求：交付周期为${JD_deliveryPeriod}，${JD_deliveryRisk}`;

        let output = `${projectName}（${businessCode}）\n\n项目交底会\n一、项目基本信息\n1、${key1_text}\n2、${key2_text}\n3、${key3_text}\n二、项目文件交底\n${key4_text}\n三、风险及应对举措\n`;
        
        const risk_points = [key5_text, JD_maintenanceRequirements, procurementRisk, JD_trialRun, JD_maintenanceAssessment, JD_testingRequirements, OT_risk];
        let counter = 1;
        risk_points.forEach(p => {
            if (p && String(p).trim()) {
                output += `${counter}、${_ensurePeriod(p)}\n`;
                counter++;
            }
        });

        output += "四、其他参会部门意见\n公共架构评估师意见详见会议纪要中【公共架构结论】部分。\n五、会议结论\n项目铁三角对项目情况、项目角色分工、项目计划及里程碑节点、项目风险及问题解决方案等内容均已了解清晰，交底完成，请项目组尽快完成合同签约。";
        return output;
    }
    
    // ======================= EVENT LISTENERS FOR BUTTONS =======================
    
    document.getElementById('btn-gen-opportunity').addEventListener('click', () => {
        const formData = gatherFormData();
        const report = generateOpportunityMinutes(formData);
        showReportDialog("商机评估会纪要", report);
    });

    document.getElementById('btn-gen-bidding').addEventListener('click', () => {
        const formData = gatherFormData();
        const report = generateBiddingMinutes(formData);
        showReportDialog("投标评估会纪要", report);
    });
    
    document.getElementById('btn-gen-kickoff').addEventListener('click', () => {
        const formData = gatherFormData();
        const report = generateKickoffMinutes(formData);
        showReportDialog("项目交底会纪要", report);
    });


    // ======================= MODAL/DIALOG HANDLING =======================
    
    function showReportDialog(title, text) {
        DOMElements.reportTitle.innerText = title;
        DOMElements.reportText.value = text;
        DOMElements.reportModal.style.display = 'flex';
    }
    document.getElementById('close-report-modal').addEventListener('click', () => DOMElements.reportModal.style.display = 'none');

    // --- PM Query Modal Logic ---
    document.getElementById('btn-query-pm').addEventListener('click', () => {
        DOMElements.pmFullTableBody.innerHTML = '';
        PM_DATA.forEach(pm => {
            const row = DOMElements.pmFullTableBody.insertRow();
            row.innerHTML = `<td>${pm.项目经理}</td><td>${pm.级别}</td><td>${pm.在职部门}</td>`;
        });
        const allDepts = [...new Set(PM_DATA.map(p => p.在职部门))].sort();
        DOMElements.pmDeptFilter.innerHTML = `<option>所有部门</option>` + allDepts.map(d => `<option>${d}</option>`).join('');
        
        performPMAutoSearch();
        filterPMTable();
        DOMElements.pmQueryModal.style.display = 'flex';
    });
    document.getElementById('close-pm-modal').addEventListener('click', () => DOMElements.pmQueryModal.style.display = 'none');
    
    function performPMAutoSearch() {
        const ironTriangleText = DOMElements.ironTriangleInput.value;
        // --- 修改后的正则表达式 ---
        const pattern = /项目经理\s*[:：]\s*(.+?)\s*[(（](.+?)[)）]/s;
        // --- 修改结束 ---
        const match = ironTriangleText.match(pattern);
        
        if (!match) {
            DOMElements.pmAutoResult.innerHTML = "未在铁三角信息中找到有效的项目经理信息。";
            return;
        }
        const pmName = match[1].trim();
        const pmDept = match[2].trim();
        const matches = PM_DATA.filter(p => p.项目经理 === pmName);
        
        if (matches.length === 0) {
            DOMElements.pmAutoResult.innerHTML = `匹配不成功：未在列表中找到名为 '${pmName}' 的项目经理。`;
            return;
        }
        matches.sort((a, b) => (a.在职部门 === pmDept ? -1 : 1) - (b.在职部门 === pmDept ? -1 : 1));
        let result_text = `<b>为 '${pmName}' 找到 ${matches.length} 个结果（部门匹配优先）：</b><br>`;
        result_text += matches.map(p => `&nbsp;&nbsp;- ${p.项目经理} (<b>${p.级别}</b>) - ${p.在职部门}`).join('<br>');
        DOMElements.pmAutoResult.innerHTML = result_text;
    }

    
    
    function filterPMTable() {
        const searchText = DOMElements.pmSearchInput.value.toLowerCase();
        const selectedDept = DOMElements.pmDeptFilter.value;
        const rows = DOMElements.pmFullTableBody.rows;
        for (let i = 0; i < rows.length; i++) {
            const name = rows[i].cells[0].textContent.toLowerCase();
            const dept = rows[i].cells[2].textContent;
            const nameMatch = !searchText || name.includes(searchText);
            const deptMatch = selectedDept === '所有部门' || dept === selectedDept;
            rows[i].style.display = (nameMatch && deptMatch) ? '' : 'none';
        }
    }
    DOMElements.pmSearchInput.addEventListener('input', filterPMTable);
    DOMElements.pmDeptFilter.addEventListener('change', filterPMTable);

    
    // --- Attendees Modal Logic ---
    document.getElementById('btn-show-attendees').addEventListener('click', () => {
        const attendeesForm = DOMElements.attendeesForm;
        attendeesForm.querySelector('#attendees-projectLevel').value = DOMElements.projectLevel.value;
        try {
            const budgetWan = parseFloat(DOMElements.budgetAmount.value) / 10000;
            attendeesForm.querySelector('#attendees-budgetAmount').value = isNaN(budgetWan) ? '' : budgetWan;
        } catch { attendeesForm.querySelector('#attendees-budgetAmount').value = ''; }
        attendeesForm.querySelector('#attendees-procurement').value = DOMElements.procurement.value;
        attendeesForm.querySelector('#attendees-cooperation').value = DOMElements.SJ_projectCooperationNeeded.value || DOMElements.TB_projectCooperationNeeded.value;
        attendeesForm.querySelector('#attendees-primarySystem').value = DOMElements.TB_isPrimarySystem.value;
        
        updateAttendeesList();
        DOMElements.attendeesModal.style.display = 'flex';
    });
    document.getElementById('close-attendees-modal').addEventListener('click', () => DOMElements.attendeesModal.style.display = 'none');
    
    function updateAttendeesList() {
        const form = DOMElements.attendeesForm;
        const getV = (id) => form.querySelector(`#${id}`).value;
        
        let roles = {};
        // --- 修改后的正则表达式 ---
        const pattern = /(.+?)\s*[:：]\s*(.+?)\s*[(（](.+?)[)）]/gs;
        // --- 修改结束 ---
        const ironTriangleText = DOMElements.ironTriangleInput.value.trim();
        let match;
        while ((match = pattern.exec(ironTriangleText)) !== null) {
             roles[match[1].trim()] = { name: match[2].trim(), department: match[3].trim() };
        }
        
        const getRoleString = roleName => {
            const info = roles[roleName];
            return info && info.name && info.department ? `${roleName}：${info.name}【${info.department}】` : roleName;
        };
        
        const all = {
            '项目经理': getRoleString("项目经理"), '销售经理': getRoleString("销售经理"), '方案经理': getRoleString("方案经理"), '交付经理': getRoleString("交付经理"),
            '法律风险评估': "法律风险评估: 李屹【法律合规部】", '项目合作': "项目合作评估: 高仲凯/许海燕【市场部（标前）】",
            '采购评估': "采购评估: 梁其容/罗晓纯【采购部】", '网信安评估': "网信安评估: 吴中华/陆艺阳【运营管理部/研发与质量管理中心、安全事业部】",
            '运维服务评估意见': "运维服务评估: 熊俊伟, 蒋朝豪【运营管理部/研发与质量管理中心】",
            '公共架构评估': (() => {
                const archMap = {
                    "IT系统事业部": "王沛文、高航",
                    "大数据AI应用事业部": "许智洋",
                    "数字政府事业部": "李佳鑫、许伟明",
                    "云网事业部": "许智洋",
                    "智呼事业部": "郑辉",
                    "智慧企业集成事业部": "郑辉、陈家辉",
                    "智慧网络运营事业部": "周宏江、高航、许伟明",
                    "智慧业财事业部": "王沛文",
                };
                const pmDept = roles["项目经理"]?.department;
                return `公共架构评估师： ${archMap[pmDept] || ''}【运营管理部/研发与质量管理中心】`;
            })()
        };

        const budget = _safeFloat(getV('attendees-budgetAmount'));
        const procurement = getV('attendees-procurement'); // 获取是否涉及外采
        const level = getV('attendees-projectLevel');       // 获取项目级别

        if (budget >= 50) {
            // 首先判断：如果不涉及外采 且 项目级别是 B类 或 C类
            if (procurement === '否' && (level === 'B类' || level === 'C类')) {
                all['财务评估'] = "财务评估: 刘椰韵【财务部】";
            } else {
                // 其他所有预算大于等于50万的情况（涉及外采，或者项目是A类）
                all['财务评估'] = "财务评估: 戴亮【财务部】";
            }
        }
        // 注意：如果预算小于50万，则 all['财务评估'] 不会被赋值，即不邀请财务参会。
        
        const required = {
            "商机评估会": ["项目经理", "销售经理", "方案经理", "交付经理"],
            "投标评估会": ["项目经理", "销售经理", "方案经理", "交付经理", "运维服务评估意见", "财务评估"],
            "项目交底会": ["项目经理", "销售经理", "方案经理", "交付经理", "公共架构评估"],
            "商机、投标评估会": ["项目经理", "销售经理", "方案经理", "交付经理", "运维服务评估意见", "财务评估"],
        };

        const optionalFlags = {
            "项目合作": getV('attendees-cooperation') === '是',
            "采购评估": getV('attendees-procurement') === '是',
            "网信安评估": getV('attendees-primarySystem') === '是',
            "法律风险评估": getV('attendees-legalRisk') === '是',
        };

        const meetingType = getV('attendees-meetingType');
        let final = (required[meetingType] || []).map(role => all[role]).filter(Boolean);
        Object.keys(optionalFlags).forEach(role => {
            if (optionalFlags[role] && all[role]) final.push(all[role]);
        });
        
        DOMElements.attendeesOutput.value = [...new Set(final)].join('\n');
    }
    DOMElements.attendeesForm.addEventListener('change', updateAttendeesList);
    DOMElements.attendeesForm.addEventListener('input', updateAttendeesList);

    // --- Email Modal Logic ---
    document.getElementById('btn-email').addEventListener('click', () => {
        repopulateEmailDepartments();
        DOMElements.emailModal.style.display = 'flex';
    });
    document.getElementById('close-email-modal').addEventListener('click', () => DOMElements.emailModal.style.display = 'none');
    
    const repopulateEmailDepartments = () => {
        DOMElements.emailChecklist.innerHTML = '';
        let depts = new Set();
        const tjsText = DOMElements.ironTriangleInput.value;
        const salesMatch = tjsText.match(/销售经理：\n.+?\((.+?)\)/s);
        if (salesMatch && EMAIL_DATA[salesMatch[1].trim()]) {
            depts.add(salesMatch[1].trim());
        }
        
        const tableRows = DOMElements.deliveryDetailsTable.querySelectorAll('tbody tr');
        tableRows.forEach(row => {
            const dept = row.querySelector('select').value;
            if (dept) depts.add(dept);
        });

        if (depts.size === 0) { // Add a blank dynamic row if no depts found
            addEmailDeptRow(true);
        } else {
            depts.forEach(dept => addEmailDeptRow(false, dept, true));
        }
        updateEmailList();
    };

    const addEmailDeptRow = (isDynamic = false, deptName = "", isChecked = false) => {
        const rowWidget = document.createElement('div');
        rowWidget.className = 'mail-dept-item'; // 应用网格布局
        
        if (isDynamic) {
            // --- 动态行 (下拉框) ---
            const control = document.createElement('select');
            control.innerHTML = [''].concat(Object.keys(EMAIL_DATA)).map(d => `<option value="${d}">${d}</option>`).join('');
            control.value = deptName;
            control.addEventListener('change', updateEmailList);
            
            rowWidget.appendChild(control); // 子元素 1: 下拉框

        } else {
            // --- 静态行 (复选框) ---
            const control = document.createElement('input');
            control.type = 'checkbox';
            control.id = `email-check-${deptName.replace(/\s+/g, '-')}`;
            control.checked = isChecked;
            control.dataset.dept = deptName;
            control.addEventListener('change', updateEmailList);

            const deptSpan = document.createElement('span');
            deptSpan.textContent = deptName;
            
            // (可选的良好体验) 点击部门名称也能选中复选框
            deptSpan.style.cursor = 'pointer';
            deptSpan.onclick = () => {
                control.checked = !control.checked;
                // 手动触发 change 事件来更新邮件列表
                control.dispatchEvent(new Event('change', { bubbles: true }));
            };

            rowWidget.appendChild(control);  // 子元素 1: 复选框
            rowWidget.appendChild(deptSpan); // 子元素 2: 部门名称
        }

        // --- 通用的移除按钮 ---
        const removeBtn = document.createElement('button');
        removeBtn.className = 'btn-remove'; // 使用您统一的 btn-remove 样式
        removeBtn.textContent = '移除';
        removeBtn.onclick = () => {
            rowWidget.remove();
            updateEmailList();
        };

        rowWidget.appendChild(removeBtn); // 子元素 3 (静态行) 或 子元素 2 (动态行)

        DOMElements.emailChecklist.appendChild(rowWidget);
    };
    
    const updateEmailList = () => {
        let leaders = [], managers = [], seenEmails = new Set();
        
        // --- 关键修改：查找 .mail-dept-item 而不是 .checklist-row ---
        const rows = DOMElements.emailChecklist.querySelectorAll('.mail-dept-item');
        // --- 修改结束 ---
        
        const getDeptFromRow = row => {
            const chk = row.querySelector('input[type="checkbox"]');
            if (chk && chk.checked) return chk.dataset.dept;
            const sel = row.querySelector('select');
            if (sel && sel.value) return sel.value;
            return null;
        };

        rows.forEach(row => {
            const dept = getDeptFromRow(row);
            if (dept && EMAIL_DATA[dept]) {
                const [name, email] = EMAIL_DATA[dept].leader;
                if (email && !seenEmails.has(email)) {
                    leaders.push(`${name} <${email}>`);
                    seenEmails.add(email);
                }
            }
        });
        rows.forEach(row => {
            const dept = getDeptFromRow(row);
            if (dept && EMAIL_DATA[dept]) {
                const [name, email] = EMAIL_DATA[dept].manager;
                if (email && !seenEmails.has(email)) {
                    managers.push(`${name} <${email}>`);
                    seenEmails.add(email);
                }
            }
        });
        
        let finalText = leaders.join('； ');
        if (leaders.length > 0 && managers.length > 0) finalText += '；\n';
        finalText += managers.join('； ');
        DOMElements.emailOutput.value = finalText;
    };
    
    document.getElementById('email-add-btn').addEventListener('click', () => addEmailDeptRow(true));
    document.getElementById('email-refresh-btn').addEventListener('click', repopulateEmailDepartments);

    // ======================= IMPORT/EXPORT LOGIC ======================
    
    document.getElementById('btn-export').addEventListener('click', () => {
        const data = gatherFormData();
        const projectName = data.projectName || '纪要数据';
        const businessCode = data.businessCode ? `(${data.businessCode})` : '';
        const timestamp = new Date().toISOString().slice(0, 16).replace(/[-T:]/g, '');
        const filename = `${projectName}${businessCode}_${timestamp}.json`;
        const blob = new Blob([JSON.stringify(data, null, 4)], { type: 'application/json' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = filename.replace(/[<>:"/\\|?*]/g, '_');;
        link.click();
        URL.revokeObjectURL(link.href);
    });

    const importInput = document.getElementById('import-file-input');
    document.getElementById('btn-import').addEventListener('click', () => importInput.click());
    importInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const data = JSON.parse(e.target.result);
                populateFormData(data);
                alert('数据导入成功！');
            } catch (err) { alert(`导入失败: ${err.message}`); }
        };
        reader.readAsText(file);
        importInput.value = '';
    });
    
    function populateFormData(data) {
        const inputs = DOMElements.mainForm.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            if (input.id && data.hasOwnProperty(input.id)) {
                input.value = data[input.id];
                input.dispatchEvent(new Event('change', { bubbles: true }));
            }
        });

        if (data.deliveryDetails) {
            const rows = DOMElements.deliveryDetailsTable.querySelector('tbody').rows;
            for(let i=0; i < rows.length; i++){ // Clear existing data first
                rows[i].cells[1].querySelector('select').value = '';
                rows[i].cells[2].querySelector('input').value = '';
                rows[i].cells[3].querySelector('input').value = '';
                rows[i].cells[4].querySelector('input').value = '';
            }
            data.deliveryDetails.forEach((rowData, index) => {
                if (index < rows.length) {
                    const row = rows[index];
                    row.cells[1].querySelector('select').value = rowData['事业部'] || '';
                    row.cells[2].querySelector('input').value = rowData['项目经理'] || '';
                    row.cells[3].querySelector('input').value = rowData['交付内容'] || '';
                    row.cells[4].querySelector('input').value = rowData['预算（万元）'] || '';
                }
            });
        }
    }

}); // End of DOMContentLoaded